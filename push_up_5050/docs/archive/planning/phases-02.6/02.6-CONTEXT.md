# Phase 2.6: Widget Redesign with New UI - Context

**Gathered:** 2026-01-22
**Status:** Ready for planning

## Phase Boundary

Replace existing Android XML widgets with new Flutter-based design and implement full calendar synchronization:

- **4x4 Large Widget**: Flutter Pushup5050Widget with today/total stats, START button, and 7-day calendar row
- **2x1 Small Widget**: Flutter Pushup5050SmallWidget with stats and 3-day calendar
- **Calendar Synchronization**: Service to read from DailyRecords, midnight missed-day detection, streak connecting lines
- **Android Integration**: Update widget providers, register new sizes, home_widget integration

---

## Implementation Decisions

### Calendar Data Structure

- **Data source**: Widgets read directly from DailyRecords (shared_preferences) — no separate cache
- **Missed day definition**: At 00:01, a new day begins. If user completed at least 1 push-up, the day is counted. If the previous day has 0 push-ups, it is NOT counted (not a "missed" day per se, just not a completed day)
- **4x4 widget calendar**: Shows current week (Monday-Sunday), not rolling 7 days
- **2x1 small widget labels**: Show day name initials only: L - M - M - G - V - S - D (Italian, single letter)
- **Data format**: Reuse existing DailyRecords structure, no new serialization format needed

### Visual Calendar States

- **Color palette**: Use exact colors and style from reference design provided (orange theme matching app)
- **Connecting line**: Glowing line between consecutive completed days (not just solid, has glow effect)
- **Missed day style**: Red outline (not solid fill) with red X mark centered inside
- **Empty state**: Show gray placeholder circles for days with no data (first week, future days)

### Update Triggers & Timing

- **Post-workout update**: Immediately (<5 seconds) via home_widget after workout saves
- **Midnight check**: WorkManager scheduled task at 00:01 to check yesterday's status and update calendar
- **Weekly refresh**: Every day at midnight — re-render calendar showing current week's days
- **App-closed updates**: Rely on Android's widget updatePeriodMillis only (30 min minimum) — no separate background service

### Claude's Discretion

- Exact WorkManager configuration (constraints, retry policy)
- Flutter widget rendering approach (FlutterEmbeddedView vs home_widget plugin capabilities)
- Visual details not specified in reference design (spacing, sizing, exact glow implementation)
- Error handling for missing or corrupted DailyRecords data

---

## Specific Ideas

- "I want the widget to look exactly like the reference design you sent"
- "Day labels should be single letter Italian initials: L M M G V S D"
- "A day with 0 push-ups is just not counted — it doesn't show as 'missed' with red X unless explicitly marked"
- "Connecting line should glow like the orange circles"

---

## Deferred Ideas

- None — discussion stayed within phase scope

---

*Phase: 02.6-widget-redesign*
*Context gathered: 2026-01-22*
