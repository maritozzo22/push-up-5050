---
phase: 02.1-foundation-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - push_up_5050/lib/services/widget_update_service.dart
  - push_up_5050/test/services/widget_update_service_test.dart
autonomous: true
user_setup: []

must_haves:
  truths:
    - "flutter pub get succeeds without errors"
    - "WidgetUpdateService uses correct widget IDs matching AndroidManifest.xml"
    - "All tests pass after widget ID fix"
    - "Widget update service can initialize and update widgets"
  artifacts:
    - path: "push_up_5050/lib/services/widget_update_service.dart"
      provides: "Widget update service with corrected widget IDs"
      exports: ["WidgetUpdateService", "updateAllWidgets", "updateWidget1", "updateWidget2", "updateWidget3"]
    - path: "push_up_5050/pubspec.yaml"
      provides: "Dependency configuration with home_widget package"
      contains: "home_widget: \\^0.5.0"
    - path: "push_up_5050/android/app/src/main/AndroidManifest.xml"
      provides: "Android widget receiver registrations"
      contains: "PushupWidgetStatsProvider|PushupWidgetCalendarProvider|PushupWidgetQuickStartProvider"
  key_links:
    - from: "lib/services/widget_update_service.dart"
      to: "AndroidManifest.xml"
      via: "Widget ID constant strings must match receiver class names"
      pattern: "PushupWidget(Stats|Calendar|QuickStart)Provider"
---

# Phase 2.1-01: Verify & Fix Widget Infrastructure

## Objective
Verify existing widget infrastructure is functional and fix critical widget ID mismatch that prevents Flutter from updating Android widgets.

**Purpose:** Most infrastructure exists (home_widget, models, tests), but WidgetUpdateService uses incorrect widget IDs that don't match AndroidManifest.xml receiver names. This breaks the bridge between Flutter and Android widgets.

**Output:** Working widget update service with correct IDs, verified dependencies, passing tests.

## Context
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md

## Context
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/02.1-foundation-setup/02.1-RESEARCH.md

# Codebase references
@push_up_5050/lib/services/widget_update_service.dart
@push_up_5050/android/app/src/main/AndroidManifest.xml
@push_up_5050/pubspec.yaml

## Tasks

### Task 1: Verify Dependencies
**type:** auto
**estimate:** small

**Action:**
Run `flutter pub get` in the push_up_5050 directory to verify home_widget and all dependencies resolve correctly. This confirms the existing pubspec.yaml configuration is valid.

**Verification:**
```bash
cd push_up_5050 && flutter pub get
```
Expected: Command succeeds with "Got dependencies" output, no errors.

**Done:**
- `flutter pub get` completes successfully
- home_widget package is available to import

---

### Task 2: Fix Widget ID Mismatch
**type:** auto
**estimate:** small

**Action:**
Edit `lib/services/widget_update_service.dart` to fix widget ID constants.

Current code uses simple IDs:
```dart
static const String _widget1Id = 'pushup_widget_stats';
static const String _widget2Id = 'pushup_widget_calendar';
static const String _widget3Id = 'pushup_widget_quick_start';
```

AndroidManifest.xml receiver names use fully qualified class names:
```xml
android:name=".widget.PushupWidgetStatsProvider"
android:name=".widget.PushupWidgetCalendarProvider"
android:name=".widget.PushupWidgetQuickStartProvider"
```

Update widget ID constants to match the Kotlin class names (without package prefix):
```dart
static const String _widget1Id = 'PushupWidgetStatsProvider';
static const String _widget2Id = 'PushupWidgetCalendarProvider';
static const String _widget3Id = 'PushupWidgetQuickStartProvider';
```

**Why this matters:** home_widget.updateWidget() expects the widget ID to match the receiver class name registered in AndroidManifest.xml. Mismatched IDs cause updateWidget() to fail silently.

**Verification:**
- Search for `_widget1Id = 'PushupWidgetStatsProvider'` in widget_update_service.dart
- Verify all three constants use the correct pattern

**Done:**
- Widget ID constants match AndroidManifest.xml receiver class names
- File compiles without errors

---

### Task 3: Update Tests for Corrected Widget IDs
**type:** auto
**estimate:** small

**Action:**
Run existing tests to verify they still pass after widget ID fix. The tests in `test/services/widget_update_service_test.dart` test behavior, not specific ID values, so they should pass unchanged.

**Verification:**
```bash
cd push_up_5050 && flutter test test/services/widget_update_service_test.dart
```
Expected: All tests pass.

**Done:**
- All widget_update_service_test.dart tests pass
- Test coverage remains intact

---

## Verification
After completing all tasks:
- [ ] `flutter pub get` succeeds
- [ ] Widget ID constants match AndroidManifest receiver names
- [ ] `flutter test test/services/widget_update_service_test.dart` passes
- [ ] `flutter test test/models/widget_data_test.dart` passes

## Success Criteria
- Dependencies are resolved and working
- Flutter widget service can communicate with Android widget receivers via home_widget
- All existing tests pass with the corrected widget IDs
- Foundation is ready for state provider integration (next plan)

## Output
After completion, create `.planning/phases/02.1-foundation-setup/02.1-01-SUMMARY.md`
