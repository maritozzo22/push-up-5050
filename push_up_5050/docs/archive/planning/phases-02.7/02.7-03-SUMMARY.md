---
phase: 02.7-widget-rebuild-from-templates
plan: 03
subsystem: ui
tags: android, widgets, kotlin, localization

# Dependency graph
requires:
  - phase: 02.7-01
    provides: widget drawable resources (colors, backgrounds, buttons, day chips)
  - phase: 02.7-02
    provides: widget layouts (4x4 and 2x1) with correct size registration
provides:
  - Updated 4x4 widget provider with localized day labels and new drawables
  - Updated 2x1 widget provider documentation
  - Correct widget info file registration in AndroidManifest
affects: [02.7-04, build-and-test]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Locale-based widget content localization"
    - "Unified drawable naming across widget sizes"
    - "Widget class name preservation for Flutter compatibility"

key-files:
  created:
    - push_up_5050/android/app/src/main/res/xml/pushup_widget_2x1_info.xml
  modified:
    - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt
    - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt
    - push_up_5050/android/app/src/main/AndroidManifest.xml

key-decisions:
  - "Locale detection via context.resources.configuration.locales.get(0)"
  - "Day labels hardcoded in provider (IT: L M M G V S D, EN: M T W T F S S)"
  - "Widget class names unchanged (required for HomeWidgetPlugin.updateWidget())"
  - "New drawable names: widget_day_chip_* instead of day_indicator_*"

patterns-established:
  - "Locale detection pattern: Check locale.language for 'it' vs default English"
  - "Widget provider update pattern: RemoteViews with new layouts and drawable references"
  - "Info file naming: pushup_widget_{size}_info.xml for clarity"

# Metrics
duration: 6min
completed: 2026-01-22
---

# Phase 02.7 Plan 03: Widget Provider Implementation Summary

**Updated widget providers to use new layouts with localized day labels and new unified drawable resources**

## Performance

- **Duration:** 6 min
- **Started:** 2026-01-22T19:05:44Z
- **Completed:** 2026-01-22T19:11:53Z
- **Tasks:** 3
- **Files modified:** 4

## Accomplishments

- Updated PushupWidgetQuickStartProvider to use R.layout.pushup_widget_4x4
- Added getDayLabels() method for locale-based day label support (Italian/English)
- Updated calendar day drawables to use new widget_day_chip_* resources
- Created pushup_widget_2x1_info.xml for proper 2x1 widget size registration
- Verified AndroidManifest references correct widget info files

## Task Commits

Each task was committed atomically:

1. **Task 1: Update PushupWidgetQuickStartProvider for 4x4 layout** - `da5651d` (feat)
2. **Task 2: Update PushupWidgetSmallProvider for 2x1 layout** - `62a15cb` (feat)
3. **Task 3: Create pushup_widget_2x1_info.xml and verify manifest** - `7c5b37a` (feat)

**Plan metadata:** (pending final docs commit)

_Note: No TDD tasks in this plan (provider updates use existing test infrastructure)_

## Files Created/Modified

### Created (1 file)
- `push_up_5050/android/app/src/main/res/xml/pushup_widget_2x1_info.xml` - 2x1 widget size registration with targetCellWidth=2 targetCellHeight=1

### Modified (3 files)
- `push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt`
  - Changed layout reference to R.layout.pushup_widget_4x4
  - Added getDayLabels() context method for locale-based labels
  - Updated updateCalendarDays() to use widget_day_chip_* drawables
  - Added Locale import
- `push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt`
  - Already using R.layout.pushup_widget_2x1 (verified correct)
  - Added documentation about widget_2x1_day_chip selector
- `push_up_5050/android/app/src/main/AndroidManifest.xml`
  - Already referencing correct info files (verified during Task 3)

## Decisions Made

1. **Locale-based day labels:** Added getDayLabels() method that checks `locale.language == "it"` to return Italian (L M M G V S D) or English (M T W T F S S) labels

2. **Drawable name migration:** Updated from old `day_indicator_*` to new `widget_day_chip_*` drawables for visual consistency with Plan 01 resources

3. **Widget class name preservation:** Kept `.widget.PushupWidgetQuickStartProvider` and `.widget.PushupWidgetSmallProvider` unchanged in manifest (required for Flutter HomeWidgetPlugin compatibility)

4. **2x1 info file creation:** Created separate `pushup_widget_2x1_info.xml` instead of reusing `pushup_widget_small_info.xml` for clearer naming convention

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all updates proceeded smoothly.

## Authentication Gates

None - no authentication required for this plan.

## Next Phase Readiness

- Widget providers ready for Plan 04 (build and test)
- All layouts, drawables, and providers aligned
- AndroidManifest correctly references new widget info files
- Localization support added for day labels
- Deep link URL (pushup5050://series_selection) unchanged
- Data parsing (weekDayData, threeDayData) unchanged

Ready for build verification and widget testing on physical device.

---
*Phase: 02.7-widget-rebuild-from-templates*
*Completed: 2026-01-22*
