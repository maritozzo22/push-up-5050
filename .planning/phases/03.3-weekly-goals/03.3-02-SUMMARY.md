---
phase: 03.3-weekly-goals
plan: 02
subsystem: data
tags: [weekly-target, daily-goal, goals-provider, statistics]

# Dependency graph
requires:
  - phase: 03.3-01
    provides: weekly state tracking infrastructure
provides:
  - Weekly target calculation (daily goal × 5 workout days)
  - Weekly goal persistence with auto-sync to daily goal changes
  - Weekly target display in statistics screen with progress visualization
affects: [weekly-review-popup, weekly-bonus-award]

# Tech tracking
tech-stack:
  added: []
  patterns: [weekly-target-calculation, auto-syncing-defaults, progress-display]

key-files:
  created: []
  modified:
    - push_up_5050/lib/repositories/storage_service.dart
    - push_up_5050/lib/providers/goals_provider.dart
    - push_up_5050/lib/models/goal.dart
    - push_up_5050/lib/providers/user_stats_provider.dart
    - push_up_5050/lib/widgets/statistics/weekly_chart_painter.dart
    - push_up_5050/lib/screens/statistics/statistics_screen.dart

key-decisions:
  - "Weekly target = daily goal × 5 (not 7) to allow for 2 rest days per week"
  - "Default weekly goal auto-calculates from daily goal to stay synced when daily goal changes"
  - "Weekly progress display uses green color when target is achieved"

patterns-established:
  - "Pattern: Auto-calculated default values in getter (getWeeklyGoal returns daily * 5 if not set)"
  - "Pattern: Target display format 'total / target' with color change on completion"

# Metrics
duration: 9min
completed: 2026-01-25
---

# Phase 03.3 Plan 02: Weekly Target Calculation Summary

**Weekly target calculation (daily goal × 5 workout days) with auto-syncing persistence and statistics screen display**

## Performance

- **Duration:** 9 min
- **Started:** 2026-01-25T15:07:16Z
- **Completed:** 2026-01-25T15:16:18Z
- **Tasks:** 3
- **Files modified:** 6

## Accomplishments

- Weekly goal persistence added to StorageService with `getWeeklyGoal()` and `setWeeklyGoal()` methods
- Weekly target calculation changed from daily × 7 to daily × 5 workout days
- `weeklyTarget` getter added to GoalsProvider for UI access
- PredefinedGoals.weekly updated from 350 to 250 push-ups
- Statistics screen now displays weekly progress (total / target) with green highlight when achieved
- UserStatsProvider weeklyGoal constant updated to 250

## Task Commits

Each task was committed atomically:

1. **Task 1: Add weekly goal persistence to StorageService** - `7c50f23` (feat)
   - Added _keyWeeklyGoal storage constant
   - Added setWeeklyGoal() to persist weekly goal
   - Added getWeeklyGoal() to retrieve weekly goal with default = daily * 5

2. **Task 2: Update GoalsProvider to use weekly goal × 5 formula** - `63ead86` (feat)
   - Changed weekly goal calculation from daily * 7 to daily * 5
   - Added weeklyTarget getter to expose value to UI
   - Updated PredefinedGoals.weekly from 350 to 250 push-ups
   - Updated UserStatsProvider.weeklyGoal constant to 250

3. **Task 3: Display weekly target in StatisticsScreen** - `3cb41a3` (feat)
   - Updated WeeklyChartCard to accept weekTotal and weeklyTarget parameters
   - Added weekly progress summary (total / target) display in chart header
   - Text color changes to green when weekly target is achieved
   - StatisticsScreen now passes weekTotal and weeklyTarget from providers

**Plan metadata:** (pending STATE.md commit)

## Files Created/Modified

- `push_up_5050/lib/repositories/storage_service.dart` - Added weekly goal persistence methods (getWeeklyGoal, setWeeklyGoal)
- `push_up_5050/lib/providers/goals_provider.dart` - Added weeklyTarget getter, changed to use getWeeklyGoal() from storage
- `push_up_5050/lib/models/goal.dart` - Updated PredefinedGoals.weekly from 350 to 250 push-ups
- `push_up_5050/lib/providers/user_stats_provider.dart` - Updated weeklyGoal constant from 350 to 250
- `push_up_5050/lib/widgets/statistics/weekly_chart_painter.dart` - Added weekTotal/weeklyTarget parameters and progress display
- `push_up_5050/lib/screens/statistics/statistics_screen.dart` - Passes weekly data to WeeklyChartCard

## Decisions Made

1. **5 workout days per week** - Used daily goal × 5 instead of × 7 to allow for 2 rest days while maintaining consistent progression
2. **Auto-calculated default** - Weekly goal default uses getDailyGoal() * 5 so it stays synced when daily goal changes
3. **Green highlight on completion** - Weekly progress text changes to green color (#4CAF50) when target is achieved
4. **Updated hardcoded constants** - UserStatsProvider.weeklyGoal constant updated from 350 to 250 for chart scaling

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - all code compiled and tests passed on first attempt.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Weekly target calculation complete and displayed in statistics
- Ready for weekly goals review popup implementation (next plan 03.3-03 was renumbered)
- Ready for weekly bonus award logic
- No blockers or concerns

---
*Phase: 03.3-weekly-goals*
*Completed: 2026-01-25*
