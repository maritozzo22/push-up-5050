---
phase: 03.3-weekly-goals
plan: 02
type: execute
wave: 2
depends_on: ["03.3-01"]
files_modified:
  - push_up_5050/lib/repositories/storage_service.dart
  - push_up_5050/lib/providers/goals_provider.dart
autonomous: true

must_haves:
  truths:
    - "Weekly target is calculated as daily goal × 5 (not 7)"
    - "Weekly target updates automatically when daily goal changes"
    - "Weekly target is displayed in statistics screen"
    - "Weekly progress is tracked from Monday to current day"
  artifacts:
    - path: "push_up_5050/lib/repositories/storage_service.dart"
      provides: "Weekly goal persistence"
      contains: "getWeeklyGoal", "setWeeklyGoal"
    - path: "push_up_5050/lib/providers/goals_provider.dart"
      provides: "Weekly target calculation"
      contains: "weeklyTarget"
  key_links:
    - from: "lib/providers/goals_provider.dart"
      to: "lib/repositories/storage_service.dart"
      via: "getDailyGoal()"
      pattern: "_storage.getDailyGoal\\(\\)"
    - from: "lib/providers/goals_provider.dart"
      to: "lib/screens/statistics/statistics_screen.dart"
      via: "weeklyTarget getter"
      pattern: "goals.weeklyTarget"
---

<objective>
Implement weekly target calculation (daily goal × 5) with persistence and display in statistics screen. The weekly goal uses 5 workout days per week (not 7) to allow for rest days while maintaining consistent progression.
</objective>

<execution_context>
@C:\Users\olegn\.claude\get-shit-done/workflows/execute-plan.md
@C:\Users\olegn\.claude\get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.3-weekly-goals/03.3-CONTEXT.md
@.planning/phases/03.3-weekly-goals/03.3-RESEARCH.md
@.planning/phases/03.3-weekly-goals/03.3-01-SUMMARY.md

# Existing patterns:
- Daily goal persistence (getDailyGoal/setDailyGoal in StorageService)
- Weekly goal calculation in GoalsProvider (_loadSavedGoals method)
- GoalsProvider already calculates weeklyGoal as daily * 7 (need to change to * 5)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add weekly goal persistence to StorageService</name>
  <files>push_up_5050/lib/repositories/storage_service.dart</files>
  <action>
Add weekly goal persistence methods following existing daily/monthly goal pattern:

1. **Add storage key** with other goal keys (around line 35):
   - static const String _keyWeeklyGoal = 'weekly_goal'

2. **setWeeklyGoal(int goal)** - Save weekly goal to storage
   - Add after setMonthlyGoal() method (around line 322)
   - Simple int persistence: _prefs.setInt(_keyWeeklyGoal, goal)
   - Follows same pattern as setDailyGoal/setMonthlyGoal

3. **getWeeklyGoal()** - Get weekly goal from storage
   - Add after getMonthlyGoal() method (around line 328)
   - Calculate default: getDailyGoal() * 5 (auto-calculate if not set)
   - Returns int
   - Formula: _prefs.getInt(_keyWeeklyGoal) ?? getDailyGoal() * 5

Key point: Default is calculated from daily goal, not a hardcoded value.
This ensures weekly goal stays synced if daily goal changes.

DO NOT:
- Hardcode default value (use getDailyGoal() * 5)
- Create separate weekly goal model (use simple int like daily/monthly)
- Add validation logic (caller handles bounds)
  </action>
  <verify>
Run: flutter analyze
  </verify>
  <done>
Weekly goal persistence:
- Storage key _keyWeeklyGoal defined
- setWeeklyGoal() saves to SharedPreferences
- getWeeklyGoal() returns persisted value or daily * 5 default
  </done>
</task>

<task type="auto">
  <name>Task 2: Update GoalsProvider to use weekly goal × 5 formula</name>
  <files>push_up_5050/lib/providers/goals_provider.dart</files>
  <action>
Update GoalsProvider to use daily goal × 5 for weekly target:

1. **Modify _loadSavedGoals() method** (around line 119-151):
   - Change weeklyGoal calculation from daily * 7 to daily * 5
   - Current line 124: final weeklyGoal = dailyGoal * 7;
   - New: final weeklyGoal = dailyGoal * 5;

2. **Update weekly Goal description** to reflect 5 days:
   - Current description shows "350 Push-up a settimana" (50 * 7)
   - Keep dynamic but note it's 5 workout days
   - Consider: "{daily} × 5 giorni" format

3. **Add weeklyTarget getter** after dailyGoal getter (around line 81):
   ```dart
   /// Get the weekly target (daily goal × 5 workout days)
   int get weeklyTarget => _storage.getWeeklyGoal();
   ```

4. **No changes to weeklyGoals getter** - it already uses the Goal model with target field

Note: The Goal.description for weekly goal may need to be updated to show the formula
more clearly (e.g., "50 × 5 = 250 push-up/week"). Keep in IT/EN.

DO NOT:
- Change monthly goal calculation (stays daily * 30)
- Update hardcoded weeklyGoal constant in UserStatsProvider (that's for chart scaling only)
- Modify Goal model or GoalType enum
  </action>
  <verify>
Run: flutter analyze
Run: flutter test (goal provider tests if any)
  </verify>
  <done>
GoalsProvider updated:
- Weekly target = daily goal × 5 (changed from × 7)
- weeklyTarget getter exposes value to UI
- Weekly goal description reflects 5 workout days
  </done>
</task>

<task type="auto">
  <name>Task 3: Display weekly target in StatisticsScreen</name>
  <files>push_up_5050/lib/screens/statistics/statistics_screen.dart</files>
  <action>
Add weekly target display to statistics screen:

1. **Locate weekly progress section** - Find where weekTotal/weekProgress is displayed

2. **Add weekly target display** showing:
   - Weekly target value (from GoalsProvider.weeklyTarget)
   - Progress toward target (weekTotal / weeklyTarget)
   - Visual: "250 / 250" format when complete

3. **Integration points** (choose one or both based on existing layout):
   - Mini stat card: Add "SETTIMANA" card with weekly target
   - Existing weekly chart: Add target label below chart
   - Progress bar: Show fill toward weekly target

Look for existing patterns:
- UserStatsProvider has weekTotal getter
- GoalsProvider exposes weeklyTarget
- Mini stat cards use MiniStat widget

Example implementation (adjust based on actual screen structure):
```dart
Consumer<GoalsProvider>(
  builder: (context, goals, child) {
    final weeklyTarget = goals.weeklyTarget;
    final progress = (stats.weekTotal / weeklyTarget).clamp(0.0, 1.0);
    return MiniStat(
      label: 'SETTIMANA',
      value: '${stats.weekTotal}',
      subtitle: '/ $weeklyTarget',
      showBar: true,
      barValue: progress,
    );
  },
)
```

DO NOT:
- Create new custom widgets (use existing MiniStat/GoalCard)
- Duplicate weekly calculation (use stats.weekTotal)
- Hardcode values (use provider data)
  </action>
  <verify>
Run: flutter analyze
Run: flutter test (statistics screen tests if any)
  </verify>
  <done>
Weekly target displayed:
- Weekly target value shown in statistics
- Progress toward target visualized
- Uses GoalsProvider.weeklyTarget
- Integrates with existing UI patterns
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- flutter test passes
- flutter analyze passes
- Weekly target = daily goal × 5 (verified with different daily goals)
- Statistics screen shows weekly target
- Target updates when daily goal changes
</verification>

<success_criteria>
1. Weekly target calculated as daily goal × 5
2. Target persists across app restarts
3. Statistics screen displays weekly target
4. Progress visualizes correctly (0-100%)
5. No hardcoded values in display logic
</success_criteria>

<output>
After completion, create `.planning/phases/03.3-weekly-goals/03.3-02-SUMMARY.md`
</output>
