---
phase: 03.3-weekly-goals
plan: 03
subsystem: ui
tags: [flutter, provider, localization, weekly-goals, bonus-points]

# Dependency graph
requires:
  - phase: 03.3-01
    provides: Weekly state tracking infrastructure (getWeekStart, getWeekNumber, weekly flags)
  - phase: 03.3-02
    provides: Weekly target calculation (daily goal x 5 formula)
provides:
  - WeeklyReviewPopup mandatory dialog widget with progress display
  - WeeklyReviewProvider with bonus calculation (500 base + 0.5/excess)
  - GoalAdjustment enum for +/- 10%, +/- 20%, -30% options
  - Months-to-goal preview calculation for each adjustment option
affects: [03.3-04, anti-cheat, points-system]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Mandatory dialog pattern (WillPopScope + barrierDismissible)
    - Bonus capping pattern (base + rate with max)
    - Goal adjustment with bounds enforcement (30-100 clamp)

key-files:
  created:
    - push_up_5050/lib/providers/weekly_review_provider.dart
    - push_up_5050/lib/widgets/weekly/weekly_review_popup.dart
  modified:
    - push_up_5050/lib/l10n/app_it.arb
    - push_up_5050/lib/l10n/app_en.arb

key-decisions:
  - "WillPopScope used to prevent Android back button dismissal (mandatory dialog)"
  - "Goal adjustment options differ based on achievement: maintain/+10%/+20% when target reached, -10%/-20%/-30% when missed"
  - "Bonus calculated as 500 base + 0.5 per excess push-up, capped at 750 total"

patterns-established:
  - "Mandatory popup pattern: WillPopScope returns false, no close button, forces user selection"
  - "Progress bar uses FractionallySizedBox with widthFactor for percentage fill"
  - "Goal adjustment applies to both daily and weekly goals (weekly = daily x 5)"

# Metrics
duration: 7min
completed: 2026-01-25
---

# Phase 03.3: Weekly Review Popup Summary

**Mandatory weekly review dialog with progress visualization, bonus calculation (500 base + 0.5/excess), and goal adjustment options (+/-10-30%) with months-to-goal preview**

## Performance

- **Duration:** 7 min
- **Started:** 2026-01-25T16:20:43Z
- **Completed:** 2026-01-25T16:27:54Z
- **Tasks:** 3
- **Files modified:** 4

## Accomplishments

- WeeklyReviewPopup widget with mandatory dialog behavior (cannot be dismissed without selecting)
- WeeklyReviewProvider with bonus calculation (500 points base, 0.5 per excess, max 750)
- Bilingual localization for weekly review (IT/EN) with proper placeholder formatting
- Goal adjustment system with bounds enforcement (30-100 daily goal range)

## Task Commits

Each task was committed atomically:

1. **Task 1: Add localization strings for weekly review popup** - `ff131fb` (feat)
2. **Task 2: Create WeeklyReviewProvider for bonus calculation** - `c93ab3a` (feat)
3. **Task 3: Create WeeklyReviewPopup widget** - `2f95dd3` (feat)

**Plan metadata:** (to be added)

## Files Created/Modified

- `push_up_5050/lib/providers/weekly_review_provider.dart` - Weekly review state management, bonus calc, goal adjustment
- `push_up_5050/lib/widgets/weekly/weekly_review_popup.dart` - Mandatory dialog with progress bar, bonus notice, adjustment options
- `push_up_5050/lib/l10n/app_it.arb` - Italian weekly review translations
- `push_up_5050/lib/l10n/app_en.arb` - English weekly review translations

## Decisions Made

- **WillPopScope for Android back button**: Used `WillPopScope(onWillPop: () async => false)` to prevent dialog dismissal via Android back button, ensuring mandatory selection
- **Goal adjustment options split by achievement**: When target reached, show maintain/+10%/+20% (positive reinforcement); when missed, show -10%/-20%/-30% (goal reduction for sustainability)
- **Bonus formula with cap**: 500 base points for reaching target + 0.5 points per excess push-up, capped at 250 excess bonus (max 750 total) to prevent farming
- **Months-to-goal simplified calculation**: Uses constant 50 target / daily goal formula (ignores current progress) for clear preview rather than complex historical tracking

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- WeeklyReviewPopup complete and ready for integration trigger logic (03.3-04)
- WeeklyReviewProvider ready to be connected to bonus awarding flow
- Localization complete for both languages
- StorageService integration already in place from 03.3-01/03.3-02

---
*Phase: 03.3-weekly-goals*
*Completed: 2026-01-25*
