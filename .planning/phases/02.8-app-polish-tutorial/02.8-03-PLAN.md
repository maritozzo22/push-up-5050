---
phase: 02.8-app-polish-tutorial
plan: 03
type: execute
wave: 3
depends_on: ["02.8-02"]
files_modified:
  - push_up_5050/lib/screens/onboarding/onboarding_screen.dart
  - push_up_5050/lib/l10n/app_en.arb
  - push_up_5050/lib/l10n/app_it.arb
  - push_up_5050/lib/main.dart
  - push_up_5050/lib/screens/settings/settings_screen.dart
  - push_up_5050/lib/repositories/storage_service.dart
autonomous: false

must_haves:
  truths:
    - "Onboarding screen shows on first app launch"
    - "Onboarding has 3 pages with swipe navigation"
    - "Page 3 allows setting daily/monthly goals"
    - "Goals persist to SharedPreferences after onboarding"
    - "Settings screen has 'Restart Tutorial' button"
    - "Onboarding supports both Italian and English"
  artifacts:
    - path: "push_up_5050/lib/screens/onboarding/onboarding_screen.dart"
      provides: "3-page onboarding with PageView, dots indicator, goal configuration"
      min_lines: 300
      exports: ["OnboardingScreen"]
    - path: "push_up_5050/lib/l10n/app_en.arb"
      provides: "English localization keys for onboarding"
      contains: "onboardingWelcomeTitle"
    - path: "push_up_5050/lib/l10n/app_it.arb"
      provides: "Italian localization keys for onboarding"
      contains: "onboardingWelcomeTitle"
    - path: "push_up_5050/lib/main.dart"
      provides: "First-run check routing to onboarding or main app"
      pattern: "onboarding_completed"
    - path: "push_up_5050/lib/screens/settings/settings_screen.dart"
      provides: "Settings screen with Restart Tutorial option"
      contains: "Riavvia tutorial|Restart tutorial"
    - path: "push_up_5050/lib/repositories/storage_service.dart"
      provides: "Storage methods for goals and onboarding flag"
      contains: "dailyGoal|monthlyGoal|onboardingCompleted"
  key_links:
    - from: "push_up_5050/lib/main.dart"
      to: "push_up_5050/lib/screens/onboarding/onboarding_screen.dart"
      via: "FutureBuilder checks onboarding_completed flag"
      pattern: "onboarding_completed.*OnboardingScreen"
    - from: "push_up_5050/lib/screens/onboarding/onboarding_screen.dart"
      to: "push_up_5050/lib/repositories/storage_service.dart"
      via: "Save goals to SharedPreferences on completion"
      pattern: "setDailyGoal|setMonthlyGoal|setOnboardingCompleted"
    - from: "push_up_5050/lib/screens/settings/settings_screen.dart"
      to: "push_up_5050/lib/screens/onboarding/onboarding_screen.dart"
      via: "Restart Tutorial button resets flag and navigates"
      pattern: "onboarding_completed.*false"
---

<objective>
Create a 3-page onboarding tutorial with bilingual support and goal configuration.

Purpose: First-time users need an introduction to the app's philosophy and a way to set personal goals. The onboarding gate ensures users configure their experience before accessing features.

Output: Complete onboarding flow with PageView navigation, goal configuration, and first-run detection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.8-app-polish-tutorial/02.8-CONTEXT.md
@.planning/phases/02.8-app-polish-tutorial/02.8-RESEARCH.md

@push_up_5050/lib/main.dart
@push_up_5050/lib/l10n/app_en.arb
@push_up_5050/lib/l10n/app_it.arb
@push_up_5050/lib/screens/settings/settings_screen.dart
@push_up_5050/lib/repositories/storage_service.dart
@push_up_5050/lib/screens/series_selection/series_selection_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onboarding localization keys</name>
  <files>
    push_up_5050/lib/l10n/app_en.arb
    push_up_5050/lib/l10n/app_it.arb
  </files>
  <action>
Add the following keys to both app_en.arb and app_it.arb:

English (app_en.arb):
```json
"onboardingWelcomeTitle": "Welcome to Push-Up 5050",
"onboardingWelcomeSubtitle": "Your journey to 5050 push-ups starts here",
"onboardingPhilosophyTitle": "Take Your Time",
"onboardingPhilosophyText": "You can take 1 month, 1 year, or 5 years. The only thing that matters is consistency.",
"onboardingHowItWorksTitle": "How It Works",
"onboardingProgressiveSeries": "Progressive Series",
"onboardingProgressiveSeriesDesc": "Series 1 = 1 push-up, Series 2 = 2 push-ups...",
"onboardingStreakTracking": "Streak Tracking",
"onboardingStreakTrackingDesc": "Track consecutive days to earn multipliers",
"onboardingPointsSystem": "Points System",
"onboardingPointsSystemDesc": "Earn points for every workout completed",
"onboardingAchievements": "Achievements",
"onboardingAchievementsDesc": "Unlock badges as you progress",
"onboardingGoalTitle": "Set Your Goals",
"onboardingDailyGoal": "Daily Goal",
"onboardingMonthlyGoal": "Monthly Goal",
"onboardingPushups": "push-ups",
"onboardingProgressPreview": "At this pace, you'll reach 5050 in {time}",
"@onboardingProgressPreview": {
  "placeholders": {
    "time": {
      "type": "String",
      "example": "about 3 months"
    }
  }
},
"onboardingGetStarted": "Get Started",
"onboardingBack": "Back",
"onboardingNext": "Next",
"settingsRestartTutorial": "Restart Tutorial",
"settingsRestartTutorialDesc": "Go through the onboarding flow again"
```

Italian (app_it.arb):
```json
"onboardingWelcomeTitle": "Benvenuto in Push-Up 5050",
"onboardingWelcomeSubtitle": "Il tuo viaggio verso 5050 flessioni inizia qui",
"onboardingPhilosophyTitle": "Prenditi il Tuo Tempo",
"onboardingPhilosophyText": "Puoi impiegare 1 mese, 1 anno o 5 anni. L'importante Ã¨ la costanza.",
"onboardingHowItWorksTitle": "Come Funziona",
"onboardingProgressiveSeries": "Serie Progressive",
"onboardingProgressiveSeriesDesc": "Serie 1 = 1 flessione, Serie 2 = 2 flessioni...",
"onboardingStreakTracking": "Tracciamento Striscia",
"onboardingStreakTrackingDesc": "Tieni traccia dei giorni consecutivi per guadagnare moltiplicatori",
"onboardingPointsSystem": "Sistema Punti",
"onboardingPointsSystemDesc": "Guadagna punti per ogni allenamento completato",
"onboardingAchievements": "Achievement",
"onboardingAchievementsDesc": "Sblocca badge mentre progredisci",
"onboardingGoalTitle": "Imposta i Tuoi Obiettivi",
"onboardingDailyGoal": "Obiettivo Giornaliero",
"onboardingMonthlyGoal": "Obiettivo Mensile",
"onboardingPushups": "flessioni",
"onboardingProgressPreview": "A questo ritmo, raggiungerai 5050 in {time}",
"@onboardingProgressPreview": {
  "placeholders": {
    "time": {
      "type": "String",
      "example": "circa 3 mesi"
    }
  }
},
"onboardingGetStarted": "Inizia",
"onboardingBack": "Indietro",
"onboardingNext": "Avanti",
"settingsRestartTutorial": "Riavvia Tutorial",
"settingsRestartTutorialDesc": "Ripeti il flusso di onboarding"
```
  </action>
  <verify>Keys exist in both .arb files with proper @ placeholder metadata</verify>
  <done>Localization keys added for all onboarding text</done>
</task>

<task type="auto">
  <name>Task 2: Add storage methods for goals and onboarding flag</name>
  <files>push_up_5050/lib/repositories/storage_service.dart</files>
  <action>
Read the existing StorageService to understand its pattern, then add methods for:
- dailyGoal (int, default 50)
- monthlyGoal (int, default 1500 = 50 * 30)
- onboardingCompleted (bool, default false)

Add these methods following the existing pattern:
```dart
// Daily goal
static const String _keyDailyGoal = 'daily_goal';

Future<void> setDailyGoal(int goal) async {
  await _prefs.setInt(_keyDailyGoal, goal);
}

int getDailyGoal() {
  return _prefs.getInt(_keyDailyGoal) ?? 50;
}

// Monthly goal
static const String _keyMonthlyGoal = 'monthly_goal';

Future<void> setMonthlyGoal(int goal) async {
  await _prefs.setInt(_keyMonthlyGoal, goal);
}

int getMonthlyGoal() {
  return _prefs.getInt(_keyMonthlyGoal) ?? 1500;
}

// Onboarding completed
static const String _keyOnboardingCompleted = 'onboarding_completed';

Future<void> setOnboardingCompleted(bool completed) async {
  await _prefs.setBool(_keyOnboardingCompleted, completed);
}

bool isOnboardingCompleted() {
  return _prefs.getBool(_keyOnboardingCompleted) ?? false;
}

// Reset onboarding (for "Restart Tutorial")
Future<void> resetOnboarding() async {
  await _prefs.remove(_keyOnboardingCompleted);
}
```

DO NOT modify existing methods or data structures.
  </action>
  <verify>StorageService has new methods: setDailyGoal, getDailyGoal, setMonthlyGoal, getMonthlyGoal, setOnboardingCompleted, isOnboardingCompleted, resetOnboarding</verify>
  <done>Storage methods added for goals and onboarding flag</done>
</task>

<task type="auto">
  <name>Task 3: Create OnboardingScreen with 3 pages</name>
  <files>push_up_5050/lib/screens/onboarding/onboarding_screen.dart</files>
  <action>
Create a new file: push_up_5050/lib/screens/onboarding/onboarding_screen.dart

Implement the OnboardingScreen with:

**Structure:**
- StatefulWidget with PageController
- 3 pages: Welcome, How It Works, Goal Configuration
- Dot indicator at bottom (3 dots, current page expanded)
- Back/Next navigation buttons (no skip - full gate)
- PageController disposed properly

**Page 1 - Welcome:**
- Hero illustration placeholder (colored Container with app icon)
- App title "PUSHUP 5050"
- Philosophy text about taking time
- "Next" button only (no back on first page)

**Page 2 - How It Works:**
- Title "How It Works"
- Feature list with icons:
  - Progressive Series (trending_up icon)
  - Streak Tracking (calendar_today icon)
  - Points System (stars icon)
  - Achievements (emoji_events icon)
- Back and Next buttons

**Page 3 - Goal Configuration:**
- Title "Set Your Goals"
- Daily goal selector with +/- buttons (reuse long-press pattern from SeriesSelection)
- Monthly goal (auto-calculated: daily * 30, tap to edit)
- Progress preview: "At this pace, you'll reach 5050 in X time"
- "Get Started" button (saves goals + onboarding flag, navigates to MainNavigationWrapper)

**UI Design:**
- Dark theme matching app: background #1A1A1A, accent #FF6B00
- SafeArea wrapping entire content
- PageView takes Expanded space
- Bottom controls in fixed-height Container

**Navigation Logic:**
```dart
void _completeOnboarding() async {
  // Save goals to StorageService
  final storage = context.read<StorageService>();
  await storage.setDailyGoal(_dailyGoal);
  await storage.setMonthlyGoal(_monthlyGoal);
  await storage.setOnboardingCompleted(true);

  // Navigate to main app, replacing onboarding
  if (mounted) {
    Navigator.of(context).pushReplacement(
      MaterialPageRoute(builder: (_) => const MainNavigationWrapper()),
    );
  }
}
```

Reuse the +/- button pattern from SeriesSelectionScreen for consistency (long-press acceleration).
  </action>
  <verify>File exists with OnboardingScreen class, 3 page builders, PageController, navigation logic</verify>
  <done>OnboardingScreen created with 3 pages, dots indicator, and goal configuration</done>
</task>

<task type="auto">
  <name>Task 4: Integrate onboarding gate in main.dart</name>
  <files>push_up_5050/lib/main.dart</files>
  <action>
Modify MyApp to check onboarding status before showing main app:

1. Import OnboardingScreen and StorageService
2. Change _MyAppState build() to use FutureBuilder:
```dart
@override
Widget build(BuildContext context) {
  return Consumer<AppSettingsService>(
    builder: (context, settings, _) {
      return FutureBuilder<bool>(
        future: _checkOnboarding(),
        builder: (context, snapshot) {
          // Loading state
          if (snapshot.connectionState != ConnectionState.done) {
            return MaterialApp(
              title: 'Push-Up 5050',
              theme: AppTheme.darkTheme,
              locale: Locale(settings.appLanguage),
              localizationsDelegates: AppLocalizations.localizationsDelegates,
              supportedLocales: AppLocalizations.supportedLocales,
              home: Scaffold(
                body: Container(
                  color: const Color(0xFF1A1A1A),
                  child: Center(
                    child: CircularProgressIndicator(
                      valueColor: AlwaysStoppedAnimation<Color>(Color(0xFFFF6B00)),
                    ),
                  ),
                ),
              ),
            );
          }

          // Show onboarding if not completed
          if (snapshot.data == false) {
            return MaterialApp(
              title: 'Push-Up 5050',
              theme: AppTheme.darkTheme,
              locale: Locale(settings.appLanguage),
              localizationsDelegates: AppLocalizations.localizationsDelegates,
              supportedLocales: AppLocalizations.supportedLocales,
              home: const OnboardingScreen(),
            );
          }

          // Show main app
          return MaterialApp(
            navigatorKey: _navigatorKey,
            title: 'Push-Up 5050',
            debugShowCheckedModeBanner: false,
            theme: AppTheme.darkTheme,
            locale: Locale(settings.appLanguage),
            localizationsDelegates: AppLocalizations.localizationsDelegates,
            supportedLocales: AppLocalizations.supportedLocales,
            initialRoute: '/',
            onGenerateRoute: (settings) {
              if (settings.name == SeriesSelectionScreen.routeName) {
                return MaterialPageRoute(
                  builder: (_) => const SeriesSelectionScreen(),
                );
              }
              return MaterialPageRoute(
                builder: (_) => const MainNavigationWrapper(),
              );
            },
            home: const MainNavigationWrapper(),
          );
        },
      );
    },
  );
}

Future<bool> _checkOnboarding() async {
  final storage = context.read<StorageService>();
  return storage.isOnboardingCompleted();
}
```

DO NOT modify existing provider setup or service initialization.
  </action>
  <verify>main.dart has FutureBuilder checking onboarding, routes to OnboardingScreen if not completed</verify>
  <done>Onboarding gate integrated in app entry point</done>
</task>

<task type="auto">
  <name>Task 5: Add Restart Tutorial button to Settings</name>
  <files>push_up_5050/lib/screens/settings/settings_screen.dart</files>
  <action>
Add a "Restart Tutorial" button in SettingsScreen:

1. Add after "Reset Profilo" button (around line 313):
```dart
const SizedBox(height: 8),

// Restart Tutorial Button
TextButton.icon(
  onPressed: () => _showRestartTutorialDialog(context, l10n),
  icon: const Icon(Icons.info_outline, color: Color(0xFF2196F3)),
  label: Text(
    l10n.settingsRestartTutorial,
    style: const TextStyle(
      color: Color(0xFF2196F3),
      fontWeight: FontWeight.w700,
      fontSize: 15,
    ),
  ),
),
```

2. Add dialog method:
```dart
void _showRestartTutorialDialog(
  BuildContext context,
  AppLocalizations l10n,
) {
  showDialog(
    context: context,
    builder: (dialogContext) => AlertDialog(
      backgroundColor: const Color(0xFF1A1F28),
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(20),
      ),
      title: Text(
        l10n.settingsRestartTutorial,
        style: const TextStyle(
          fontSize: 18,
          fontWeight: FontWeight.w800,
          color: Colors.white,
        ),
      ),
      content: Text(
        l10n.settingsRestartTutorialDesc,
        style: TextStyle(
          fontSize: 15,
          fontWeight: FontWeight.w500,
          color: Colors.white.withOpacity(0.80),
        ),
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(dialogContext),
          child: Text(
            l10n.settingsResetConfirmNo,
            style: const TextStyle(
              color: Colors.white,
              fontWeight: FontWeight.w600,
            ),
          ),
        ),
        TextButton(
          onPressed: () async {
            final storage = context.read<StorageService>();
            await storage.resetOnboarding();
            if (context.mounted) {
              Navigator.pop(dialogContext);
              // Navigate to onboarding
              Navigator.of(context).pushReplacement(
                MaterialPageRoute(
                  builder: (_) => const OnboardingScreen(),
                ),
              );
            }
          },
          child: Text(
            l10n.onboardingGetStarted,
            style: const TextStyle(
              color: Color(0xFF2196F3),
              fontWeight: FontWeight.w700,
            ),
          ),
        ),
      ],
    ),
  );
}
```

3. Add import for OnboardingScreen at top of file
  </action>
  <verify>SettingsScreen has Restart Tutorial button that resets onboarding flag and navigates to OnboardingScreen</verify>
  <done>Settings screen includes Restart Tutorial option with confirmation dialog</done>
</task>

<task type="auto">
  <name>Task 6: Run localization generator</name>
  <files>push_up_5050/lib/l10n/</files>
  <action>
1. Navigate to project directory: `cd push_up_5050`
2. Generate localization files: `flutter gen-l10n`

This regenerates app_localizations.dart with the new onboarding keys.
  </action>
  <verify>flutter gen-l10n completes without errors</verify>
  <done>Localization files regenerated with new keys</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete onboarding flow with 3 pages, goal configuration, and first-run detection</what-built>
  <how-to-verify>
1. Reset onboarding: In Settings, tap "Restart Tutorial" and confirm
2. Verify onboarding appears with Page 1 (Welcome)
3. Test navigation:
   - Swipe to next page
   - Tap "Next" button
   - Verify dots indicator updates
4. On Page 2 (How It Works), verify all 4 features displayed
5. On Page 3 (Goals):
   - Tap +/- to change daily goal
   - Verify monthly goal auto-updates (daily * 30)
   - Tap monthly goal to edit manually
   - Verify progress preview text updates
6. Tap "Get Started"
7. Verify app navigates to main home screen
8. Close and reopen app - onboarding should NOT appear (flag persisted)
9. Go to Settings, verify "Restart Tutorial" button exists
10. Test both languages: Change language in Settings, restart onboarding to verify translations

Report any issues with navigation, persistence, or layout.
  </how-to-verify>
  <resume-signal>Type "approved" if onboarding works correctly, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
- OnboardingScreen exists with 3 page builders
- PageController properly initialized and disposed
- Dot indicator shows correct page position
- Daily/monthly goal selectors work with +/- buttons
- Goals persist to SharedPreferences after completion
- First-run gate in main.dart works correctly
- Restart Tutorial button in Settings resets flag and navigates
- Both Italian and English localizations work
</verification>

<success_criteria>
- App builds and installs without errors
- Onboarding shows on first launch (after reset)
- All 3 pages display correctly with proper navigation
- Goals save and persist
- Onboarding doesn't show again after completion
- Restart Tutorial button works
- Bilingual support functional
- User confirms complete onboarding flow works
</success_criteria>

<output>
After completion, create `.planning/phases/02.8-app-polish-tutorial/02.8-03-SUMMARY.md`
</output>
