# Phase 02.8: App Polish & Tutorial - Research

**Researched:** 2026-01-23
**Domain:** Flutter UI (onboarding, localization, app icons, overflow fixes)
**Confidence:** HIGH

## Summary

This phase involves four distinct areas that require different Flutter patterns and libraries:
1. **Onboarding Tutorial** - A 3-page first-run experience with PageView, dots indicator, bilingual support
2. **UI Overflow Fixes** - Fix RenderFlex overflow errors on Statistics and SeriesSelection screens
3. **Android App Icon** - Configure adaptive launcher icon using existing assets
4. **Emulator Testing** - Build, install, and test on Android emulator

The project already has localization infrastructure (IT/EN) using Flutter's official localization system, which simplifies bilingual onboarding. The app icon assets exist but need proper configuration via `flutter_launcher_icons`. Overflow issues can be resolved with standard Flutter layout widgets.

**Primary recommendation:** Use pure Flutter widgets (PageView, PageController) for onboarding without external packages, wrap overflow-affected screens in SingleChildScrollView, and use the existing `flutter_launcher_icons` configuration in pubspec.yaml to regenerate icons with proper assets.

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| Flutter SDK | 3.0+ | UI framework | Official, built-in PageView widget for onboarding |
| flutter_localizations | sdk | Official localization | Already configured for IT/EN support |
| intl | ^0.20.2 | Internationalization | Already in pubspec.yaml |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| shared_preferences | ^2.2.2 | First-run flag storage | Already in pubspec.yaml for settings persistence |
| flutter_launcher_icons | ^0.13.1 | Generate app icons | Already configured in pubspec.yaml |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Pure Flutter PageView | introduction_screen package | External package adds dependency; PageView is sufficient for 3-page flow |
| Manual icon placement | icons_launcher | flutter_launcher_icons already configured; no need for alternative |

**Installation:**
```bash
# All dependencies already in pubspec.yaml
flutter pub get
```

## Architecture Patterns

### Onboarding Screen Pattern

**What:** A full-screen first-run experience with swipeable pages and dot indicators

**When to use:** Required for first app launch; must be completed before accessing app features (full gate)

**Example structure:**
```dart
// Based on Flutter PageView pattern
// Source: https://docs.flutter.dev/cookbook/design/tabs
// And: https://medium.com/@dev.thantzin/step-by-step-guide-to-flutter-intro-onboarding-screens-pure-flutter-no-packages-28f2d9cb7e07

PageView(
  controller: _pageController,
  onPageChanged: (int index) {
    setState(() {
      _currentPage = index;
    });
  },
  children: [
    _buildWelcomePage(),    // Page 1: Welcome + Philosophy
    _buildHowItWorksPage(), // Page 2: Features tour
    _buildGoalPage(),       // Page 3: Goal configuration
  ],
)

// Dot indicator
Row(
  mainAxisAlignment: MainAxisAlignment.center,
  children: List<Widget>.generate(3, (int index) {
    return AnimatedContainer(
      duration: Duration(milliseconds: 300),
      margin: EdgeInsets.symmetric(horizontal: 5),
      height: 8,
      width: _currentPage == index ? 24 : 8,
      decoration: BoxDecoration(
        color: _currentPage == index ? primaryColor : greyColor,
        borderRadius: BorderRadius.circular(4),
      ),
    );
  }),
)
```

### Localization Pattern for Bilingual Onboarding

**What:** Device locale detection for automatic language selection

**When to use:** Onboarding needs to display in Italian or English based on device language

**Example:**
```dart
// App already has localization infrastructure
// Source: lib/l10n/app_localizations.dart

// In onboarding widget
AppLocalizations l10n = AppLocalizations.of(context)!;
Text(l10n.onboardingWelcomeTitle)

// Locale detection is automatic via MaterialApp configuration:
// locale: Locale(settings.appLanguage)
// supportedLocales: AppLocalizations.supportedLocales // Locale('en'), Locale('it')
```

### First-Run Detection Pattern

**What:** SharedPreferences flag to track if onboarding was completed

**When to use:** Check app launch to determine if onboarding should be shown

**Example:**
```dart
// Source: StackOverflow pattern for onboarding flag
// https://stackoverflow.com/questions/59241566/flutter-onboarding-screen-only-one-time

// Add to main.dart or create OnboardingService
static const String _keyOnboardingCompleted = 'onboarding_completed';

Future<bool> isOnboardingCompleted() async {
  final prefs = await SharedPreferences.getInstance();
  return prefs.getBool(_keyOnboardingCompleted) ?? false;
}

Future<void> setOnboardingCompleted(bool value) async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setBool(_keyOnboardingCompleted, value);
}

// Usage in MyApp build():
if (!snapshot.data!) {
  return OnboardingScreen();
}
return MainNavigationWrapper();
```

### Overflow Fix Pattern

**What:** SingleChildScrollView wrapping content that exceeds screen height

**When to use:** RenderFlex overflow errors on screens with variable content height

**Example:**
```dart
// Source: Flutter docs for ScrollView
// https://docs.flutter.dev/get-started/flutter-for/compose-devs

// For StatisticsScreen (already has SingleChildScrollView - may need padding fix)
// For SeriesSelectionScreen (needs to be added):
Scaffold(
  body: Stack(
    children: [
      const AppBackground(),
      SafeArea(
        child: SingleChildScrollView(  // ADD THIS WRAPPER
          physics: const AlwaysScrollableScrollPhysics(),
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal: 22),
            child: Column(
              // existing content
            ),
          ),
        ),
      ),
    ],
  ),
)
```

### App Icon Configuration Pattern

**What:** Using flutter_launcher_icons to generate adaptive icons from source assets

**When to use:** Setting up or updating app launcher icons

**Example:**
```yaml
# Source: pubspec.yaml already configured
# flutter_launcher_icons: ^0.13.1

flutter_launcher_icons:
  android: true
  ios: false
  image_path: "assets/launcher/icon.png"
  adaptive_icon_background: "#000000"
  adaptive_icon_foreground: "assets/launcher/icon.png"
  min_sdk_android: 21
```

**Commands:**
```bash
# Generate icons from configured assets
flutter pub run flutter_launcher_icons
```

### Anti-Patterns to Avoid

- **External onboarding packages**: For 3 pages, PageView is sufficient. Packages like `introduction_screen` add unnecessary dependencies.
- **Hardcoded navigation checks**: Don't sprinkle onboarding checks throughout widgets. Use a single gate in main.dart or create an onboarding wrapper widget.
- **Ignoring safe areas**: Always use SafeArea for full-screen onboarding to account for notches/status bars.
- **Manual icon file copying**: Let flutter_launcher_icons generate all sizes. Don't manually copy files to mipmap directories.

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| App icon generation | Manual resizing and copying to mipmap-* folders | flutter_launcher_icons package | Generates all 5 density sizes automatically, handles adaptive icons |
| Locale detection | Custom platform channel code to get device language | flutter_localizations + AppLocalizations | Built-in, handles RTL, consistent across app |
| Persistent storage | Custom file I/O or SQLite for a single boolean flag | shared_preferences | Async-safe, type-safe, already used in app |

**Key insight:** For simple onboarding with 3 pages, pure Flutter widgets are cleaner than packages. Only use shared_preferences (already a dependency) for persistence.

## Common Pitfalls

### Pitfall 1: PageController Not Disposed

**What goes wrong:** Memory leak when onboarding screen is disposed

**Why it happens:** PageController is a Listenable that must be disposed

**How to avoid:** Always dispose PageController in State disposal

**Warning signs:** Analyzer warnings about missing dispose calls

```dart
class _OnboardingScreenState extends State<OnboardingScreen> {
  late PageController _pageController;

  @override
  void initState() {
    super.initState();
    _pageController = PageController();
  }

  @override
  void dispose() {
    _pageController.dispose();  // MUST DO THIS
    super.dispose();
  }
}
```

### Pitfall 2: Onboarding Gate Race Condition

**What goes wrong:** Onboarding screen flashes before main content loads

**Why it happens:** Checking SharedPreferences is async; main.dart might show loading state

**How to avoid:** Use FutureBuilder in MyApp.build() or create initialization wrapper

**Warning signs:** Seeing onboarding flash briefly even when already completed

```dart
// In MyApp:
@override
Widget build(BuildContext context) {
  return Consumer<AppSettingsService>(
    builder: (context, settings, _) {
      return FutureBuilder<bool>(
        future: _checkOnboarding(),
        builder: (context, snapshot) {
          if (snapshot.connectionState != ConnectionState.done) {
            return MaterialApp(home: SplashScreen()); // Show loading
          }
          if (snapshot.data == false) {
            return MaterialApp(home: OnboardingScreen());
          }
          return MaterialApp(home: MainNavigationWrapper());
        },
      );
    },
  );
}
```

### Pitfall 3: Overflow Fix Breaks Layout

**What goes wrong:** Adding SingleChildScrollView causes content to not fill screen height

**Why it happens:** Column inside ScrollView doesn't know available height

**How to avoid:** Use Spacer carefully or consider LayoutBuilder for height calculations

**Warning signs:** Widgets that should be at bottom move up, extra whitespace appears

### Pitfall 4: App Icon Not Updating

**What goes wrong:** After running flutter_launcher_icons, old icon still shows

**Why it happens:** Need to clean build, reinstall app, or icon cache in launcher

**How to avoid:** Run clean commands and fully reinstall after icon generation

**Warning signs:** Icon looks different in app folder than on launcher

```bash
flutter clean
flutter pub get
flutter pub run flutter_launcher_icons
flutter build apk
flutter install
```

### Pitfall 5: Localization Keys Missing for Onboarding

**What goes wrong:** Onboarding shows raw key names instead of translated text

**Why it happens:** New keys added to .arb files but not regenerated

**How to avoid:** Always run `flutter gen-l10n` after modifying .arb files

**Warning signs:** Text like "onboardingWelcomeTitle" displays in UI instead of actual text

```bash
# After adding onboarding keys to app_en.arb and app_it.arb:
flutter gen-l10n
```

## Code Examples

### Complete Onboarding Page Structure

```dart
// Verified pattern combining PageView with dots and navigation
// Source: Medium onboarding guide + Flutter docs

class OnboardingScreen extends StatefulWidget {
  const OnboardingScreen({super.key});

  @override
  State<OnboardingScreen> createState() => _OnboardingScreenState();
}

class _OnboardingScreenState extends State<OnboardingScreen> {
  late PageController _pageController;
  int _currentPage = 0;

  @override
  void initState() {
    super.initState();
    _pageController = PageController();
  }

  @override
  void dispose() {
    _pageController.dispose();
    super.dispose();
  }

  void _goToPage(int page) {
    _pageController.animateToPage(
      page,
      duration: Duration(milliseconds: 300),
      curve: Curves.easeInOut,
    );
  }

  @override
  Widget build(BuildContext context) {
    final l10n = AppLocalizations.of(context)!;

    return Scaffold(
      body: SafeArea(
        child: Column(
          children: [
            Expanded(
              child: PageView(
                controller: _pageController,
                onPageChanged: (int index) {
                  setState(() => _currentPage = index);
                },
                children: [
                  _buildWelcomePage(l10n),
                  _buildHowItWorksPage(l10n),
                  _buildGoalPage(l10n),
                ],
              ),
            ),
            _buildBottomControls(l10n),
          ],
        ),
      ),
    );
  }

  Widget _buildBottomControls(AppLocalizations l10n) {
    return Padding(
      padding: EdgeInsets.all(24),
      child: Column(
        children: [
          // Dots indicator
          Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: List.generate(3, (index) {
              return AnimatedContainer(
                duration: Duration(milliseconds: 300),
                margin: EdgeInsets.symmetric(horizontal: 4),
                height: 8,
                width: _currentPage == index ? 24 : 8,
                decoration: BoxDecoration(
                  color: _currentPage == index
                    ? Color(0xFFFF7A18)
                    : Color(0xFF4A4A4A),
                  borderRadius: BorderRadius.circular(4),
                ),
              );
            }),
          ),
          SizedBox(height: 24),
          // Navigation buttons
          if (_currentPage < 2)
            Row(
              children: [
                if (_currentPage > 0)
                  Expanded(
                    child: _NavButton(
                      text: l10n.back,
                      onTap: () => _goToPage(_currentPage - 1),
                    ),
                  ),
                if (_currentPage > 0) SizedBox(width: 16),
                Expanded(
                  child: _NavButton(
                    text: l10n.next,
                    isPrimary: true,
                    onTap: () => _goToPage(_currentPage + 1),
                  ),
                ),
              ],
            )
          else
            _NavButton(
              text: l10n.getStarted,
              isPrimary: true,
              onTap: _completeOnboarding,
            ),
        ],
      ),
    );
  }

  void _completeOnboarding() async {
    // Save goals and flag onboarding complete
    // Navigate to main app
  }
}
```

### Emulator Build and Install Commands

```bash
# Source: Flutter Android setup docs + StackOverflow APK installation
# https://docs.flutter.dev/platform-integration/android/setup
# https://stackoverflow.com/questions/69697698/flutter-release-apk-installation-in-emulator

# List available emulators
flutter emulators

# Launch specific emulator
flutter emulators --launch <emulator_id>

# Or use Android Studio AVD Manager

# Build debug APK
flutter build apk --debug

# Install on running emulator
flutter install

# Or run directly on emulator
flutter run -d <device_id>

# For testing, use split-debug-info to get better crash logs
flutter build apk --debug --split-debug-info=./debug-info
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Manual onboarding with packages | Pure Flutter PageView | ~2023 | Cleaner code, fewer dependencies |
| Manual icon file management | flutter_launcher_icons automation | ~2020 | Consistent icon generation, adaptive icons |
| Hardcoded navigation routing | MaterialApp onGenerateRoute | ~2021 | Centralized routing, easier to modify |

**Deprecated/outdated:**
- **introduction_screen package**: Still works but unnecessary overhead for simple onboarding
- **Manual locale detection**: Flutter's localization system handles this automatically
- **Copy-pasting icon files to mipmap folders**: Let flutter_launcher_icons handle it

## Open Questions

1. **Goal Storage Location**
   - What we know: Goals need to be persisted from onboarding
   - What's unclear: Should use StorageService or AppSettingsService or create new OnboardingService
   - Recommendation: Add to StorageService alongside other app data, create daily/monthly goal keys

2. **Progress Preview Calculation**
   - What we know: Need to show "At this pace, you'll reach 5050 in X days"
   - What's unclear: Exact calculation formula and display format (days vs months vs years)
   - Recommendation: Use simple division (5050 / daily_goal) and format intelligently based on result

3. **Overflow Root Cause**
   - What we know: Statistics and SeriesSelection have overflow issues
   - What's unclear: Whether it's fixed height content, missing SafeArea, or keyboard appearing
   - Recommendation: Investigate on actual device/emulator to identify root cause before applying fix

## Sources

### Primary (HIGH confidence)
- [Flutter Official Docs - PageView and Navigation](https://docs.flutter.dev/cookbook/design/tabs) - Verified PageView pattern for onboarding
- [Flutter Official Docs - ScrollView](https://docs.flutter.dev/get-started/flutter-for/compose-devs) - SingleChildScrollView usage
- [Flutter Official Docs - App Icons](https://docs.flutter.dev/deployment/android) - flutter_launcher_icons configuration
- [Project Source Code](file:///C:/Script/Android-Apps/Push-up%20flutter%20Nuovo%20test/push_up_5050/) - Existing localization infrastructure, StorageService patterns

### Secondary (MEDIUM confidence)
- [Flutter PageView Onboarding Tutorial (Medium)](https://medium.com/@dev.thantzin/step-by-step-guide-to-flutter-intro-onboarding-screens-pure-flutter-no-packages-28f2d9cb7e07) - Pure Flutter onboarding implementation
- [Flutter PageView Localization Guide (2026)](https://flutterlocalisation.com/blog/flutter-pageview-localization) - Localization patterns for PageView
- [RenderFlex Overflow Fixes (Omi.me)](https://www.omi.me/blogs/flutter-errors/a-renderflex-overflowed-by-x-pixels-on-the-bottom-in-flutter-causes-and-how-to-fix) - Bottom overflow solutions
- [flutter_launcher_icons GitHub](https://github.com/fluttercommunity/flutter_launcher_icons) - Package documentation
- [Onboarding First-Run Pattern (StackOverflow)](https://stackoverflow.com/questions/59241566/flutter-onboarding-screen-only-one-time) - SharedPreferences flag pattern
- [Flutter Android Setup (Official)](https://docs.flutter.dev/platform-integration/android/setup) - Emulator and build commands

### Tertiary (LOW confidence)
- [How to Fix RenderFlex Overflow (Dhiwise)](https://www.dhiwise.com/post/how-to-fix-the-renderflex-overflowed-error-in-flutter) - General overflow solutions (2025)

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All patterns verified with official Flutter docs
- Architecture: HIGH - PageView, SingleChildScrollView, SharedPreferences are standard Flutter widgets
- Pitfalls: HIGH - Common issues documented in Flutter community and official docs

**Research date:** 2026-01-23
**Valid until:** 2026-02-23 (30 days - stable APIs, unlikely to change)
