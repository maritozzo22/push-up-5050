---
phase: 04.6-bug-fixes-testing
plan: 01
subsystem: data-providers
tags: [provider, goals, storage, dynamic-values, ui-sync]

# Dependency graph
requires:
  - phase: 03.5-smart-notifications
    provides: StorageService.getDailyGoal() method, GoalsProvider infrastructure
provides:
  - Dynamic daily goal value reading from storage in UserStatsProvider
  - Home screen displaying personalized daily goal from GoalsProvider
  - SeriesSelectionScreen using dynamic goal for workout guard
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Instance getter pattern for dynamic storage values"
    - "Consumer3 for multi-provider dependencies"
    - "GoalsProvider as single source of truth for goal values"

key-files:
  created: []
  modified:
    - push_up_5050/lib/providers/user_stats_provider.dart
    - push_up_5050/lib/screens/home/home_screen.dart
    - push_up_5050/lib/screens/series_selection/series_selection_screen.dart

key-decisions:
  - "UserStatsProvider.dailyGoal changed from static const to instance getter reading from storage"
  - "Home screen uses Consumer3 to access both UserStatsProvider and GoalsProvider"
  - "Daily goal display uses GoalsProvider.dailyGoal.target for personalized value"

patterns-established:
  - "Pattern: Dynamic values via instance getters instead of static constants"
  - "Pattern: GoalsProvider as source of truth for all goal-related UI values"

# Metrics
duration: ~5min
completed: 2026-01-30
---

# Phase 04.6 Plan 01: Dynamic Daily Goal from Storage Summary

**UserStatsProvider dailyGoal now reads from storage instead of hardcoded 50, Home screen displays personalized goal value via GoalsProvider**

## Performance

- **Duration:** 5 min
- **Started:** 2026-01-30T19:47:43Z
- **Completed:** 2026-01-30T19:52:52Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments

- Changed `UserStatsProvider.dailyGoal` from `static const int = 50` to instance getter `int get dailyGoal => _storage.getDailyGoal()`
- Updated Home screen START button to use `goals.dailyGoal.target` instead of static constant
- Updated Home screen MiniStat "OGGI" card to use `Consumer<GoalsProvider>` for dynamic goal display
- Updated SeriesSelectionScreen to use `GoalsProvider` for goal completion check
- Added `GoalsProvider` import to SeriesSelectionScreen

## Task Commits

1. **Task 1: Change UserStatsProvider.dailyGoal from static const to dynamic getter** - `4fee7e0` (feat)
   - Note: This task's changes were bundled into commit 4fee7e0 which includes multiple related changes

2. **Task 2: Update Home screen to use GoalsProvider for daily goal display** - `4fee7e0` (feat)
   - Note: This task's changes were bundled into commit 4fee7e0 which includes multiple related changes

**Plan metadata:** N/A (changes bundled into existing commit)

_Note: The changes for this plan were already committed as part of commit 4fee7e0. This summary documents those changes for phase tracking._

## Files Created/Modified

- `push_up_5050/lib/providers/user_stats_provider.dart` - Changed dailyGoal from static const to instance getter
- `push_up_5050/lib/screens/home/home_screen.dart` - Updated to use Consumer3 and Consumer<GoalsProvider> for dynamic goal
- `push_up_5050/lib/screens/series_selection/series_selection_screen.dart` - Added GoalsProvider import and updated goal check

## Changes Detail

### UserStatsProvider (lines 108-111)
**Before:**
```dart
/// Daily goal in pushups.
static const int dailyGoal = 50;
```

**After:**
```dart
/// Get the current daily goal from storage.
///
/// Returns the user's personalized goal from onboarding (default: 50).
int get dailyGoal => _storage.getDailyGoal();
```

### HomeScreen START button (lines 284-295)
**Before:**
```dart
Consumer2<UserStatsProvider, ActiveWorkoutProvider>(
  builder: (context, stats, workoutProvider, child) {
    final goalComplete = stats.todayPushups >= UserStatsProvider.dailyGoal;
```

**After:**
```dart
Consumer3<UserStatsProvider, ActiveWorkoutProvider, GoalsProvider>(
  builder: (context, stats, workoutProvider, goals, child) {
    final goalComplete = stats.todayPushups >= goals.dailyGoal.target;
```

### HomeScreen MiniStat OGGI card (lines 350-365)
**Before:**
```dart
MiniStat(
  label: 'OGGI',
  value: '${stats.todayPushups}',
  showBar: true,
  barValue: (stats.todayPushups / UserStatsProvider.dailyGoal).clamp(0.0, 1.0),
  subtitle: '/ ${UserStatsProvider.dailyGoal}',
),
```

**After:**
```dart
Consumer<GoalsProvider>(
  builder: (context, goals, child) {
    final dailyGoal = goals.dailyGoal.target;
    return FrostCard(
      height: 120,
      child: MiniStat(
        label: 'OGGI',
        value: '${stats.todayPushups}',
        showBar: true,
        barValue: (stats.todayPushups / dailyGoal).clamp(0.0, 1.0),
        subtitle: '/ $dailyGoal',
      ),
    );
  },
),
```

### SeriesSelectionScreen (lines 8, 293-295)
**Before:**
```dart
// No GoalsProvider import
...
if (userStats.todayPushups >= UserStatsProvider.dailyGoal) {
```

**After:**
```dart
import 'package:push_up_5050/providers/goals_provider.dart';
...
final goals = context.read<GoalsProvider>();
if (userStats.todayPushups >= goals.dailyGoal.target) {
```

## Decisions Made

- **Instance getter over method call:** Used `int get dailyGoal` instead of `int getDailyGoal()` for cleaner API consistency with other getters in the provider
- **GoalsProvider as single source:** Used GoalsProvider.dailyGoal.target in UI rather than calling storage directly, maintaining provider pattern consistency
- **Consumer3 for START button:** Upgraded from Consumer2 to Consumer3 to access GoalsProvider alongside UserStatsProvider and ActiveWorkoutProvider

## Deviations from Plan

### Additional Files Modified

**1. SeriesSelectionScreen required update**
- **Found during:** Task 2 verification (searching for remaining static references)
- **Issue:** SeriesSelectionScreen also referenced `UserStatsProvider.dailyGoal` static constant
- **Fix:** Added GoalsProvider import and updated goal completion check to use `goals.dailyGoal.target`
- **Files modified:** push_up_5050/lib/screens/series_selection/series_selection_screen.dart
- **Rationale:** Necessary for consistency - all static references must be removed to fully fix the bug

---

**Total deviations:** 1 auto-fix (1 additional file requiring update)
**Impact on plan:** Necessary to fully resolve the bug - leaving static reference would have caused incorrect behavior in series selection flow

## Issues Encountered

- **Changes already committed:** The changes for this plan were found to be already committed in commit `4fee7e0` as part of plan 04.6-02 work. This summary documents those changes for phase tracking purposes.

## Verification

- No remaining `UserStatsProvider.dailyGoal` static references found in codebase
- Flutter analyze passes without errors on modified files
- GoalsProvider is imported in all files that need dynamic daily goal access

## Next Phase Readiness

- Dynamic daily goal is now fully functional across all UI components
- Personalized onboarding goal values (e.g., 20 instead of 50) will correctly display
- Ready for next bug fix in phase 04.6

---
*Phase: 04.6-bug-fixes-testing*
*Completed: 2026-01-30*
