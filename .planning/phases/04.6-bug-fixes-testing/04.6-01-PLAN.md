---
phase: 04.6-bug-fixes-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - push_up_5050/lib/providers/user_stats_provider.dart
  - push_up_5050/lib/screens/home/home_screen.dart
autonomous: true

must_haves:
  truths:
    - "Home screen displays personalized daily goal value (e.g., '0/20' for 20 goal)"
    - "Changing onboarding goal value is immediately reflected on home screen"
    - "Daily goal bar correctly fills based on personalized goal (not hardcoded 50)"
  artifacts:
    - path: "push_up_5050/lib/providers/user_stats_provider.dart"
      provides: "Dynamic daily goal from storage"
      contains: "int get dailyGoal"
    - path: "push_up_5050/lib/screens/home/home_screen.dart"
      provides: "Home screen using dynamic daily goal"
      contains: "GoalsProvider|Consumer<GoalsProvider>"
  key_links:
    - from: "push_up_5050/lib/screens/home/home_screen.dart"
      to: "push_up_5050/lib/providers/goals_provider.dart"
      via: "Consumer<GoalsProvider> for daily goal value"
      pattern: "Consumer.*GoalsProvider.*dailyGoal"
    - from: "push_up_5050/lib/providers/user_stats_provider.dart"
      to: "push_up_5050/lib/repositories/storage_service.dart"
      via: "getDailyGoal() call"
      pattern: "_storage\\.getDailyGoal\\(\\)"
---

<objective>
Fix BUG-01: Onboarding daily goal value not reflected in Home screen display.

Currently, UserStatsProvider.dailyGoal is a hardcoded `static const int = 50`. Home screen uses this static value, displaying "0/50" even when user selected a different goal (e.g., 20) during onboarding. The goal value is correctly stored in StorageService but not read by the UI.

Purpose: Ensure users see their personalized daily goal on the home screen, providing accurate progress indication.
Output: Dynamic daily goal reading from storage, displayed correctly in Home screen MiniStat widget.
</objective>

<execution_context>
@C:\Users\olegn\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\olegn\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/phases/04.6-bug-fixes-testing/04.6-RESEARCH.md
@.planning/ROADMAP.md
@.planning/STATE.md
@push_up_5050/lib/providers/user_stats_provider.dart
@push_up_5050/lib/providers/goals_provider.dart
@push_up_5050/lib/screens/home/home_screen.dart
@push_up_5050/lib/repositories/storage_service.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Change UserStatsProvider.dailyGoal from static const to dynamic getter</name>
  <files>push_up_5050/lib/providers/user_stats_provider.dart</files>
  <action>
    In user_stats_provider.dart, line 109:

    1. Change `static const int dailyGoal = 50;` to an instance getter:
       ```dart
       /// Get the current daily goal from storage.
       ///
       /// Returns the user's personalized goal from onboarding (default: 50).
       int get dailyGoal => _storage.getDailyGoal();
       ```

    2. Update line 115 (`bool get isTodayGoalComplete`) to use the instance getter (already correct).

    3. Update line 430 in `_computeWeekSeries()` to use the instance getter (already correct as `dailyGoal`).

    4. Verify line 166 already reads from storage: `final dailyGoal = _storage.getDailyGoal();` (already correct).

    DO NOT modify: weeklyGoal (line 106) which remains static at 250.
  </action>
  <verify>Search for "static const int dailyGoal" - should NOT exist. Search for "int get dailyGoal" - should exist.</verify>
  <done>UserStatsProvider.dailyGoal is now an instance getter reading from storage, not a hardcoded constant.</done>
</task>

<task type="auto">
  <name>Task 2: Update Home screen to use GoalsProvider for daily goal display</name>
  <files>push_up_5050/lib/screens/home/home_screen.dart</files>
  <action>
    In home_screen.dart, find all usages of `UserStatsProvider.dailyGoal` (lines ~287, ~358):

    1. Read the home screen file to locate the MiniStat widgets showing daily goal progress.

    2. Replace static `UserStatsProvider.dailyGoal` references with dynamic value from GoalsProvider:
       - Wrap the affected MiniStat widgets in `Consumer<GoalsProvider>`
       - Get daily goal via `goals.dailyGoal.target` (the Goal model's target field)
       - Use this value for: barValue calculation and subtitle display

    Example pattern to apply:
    ```dart
    Consumer<GoalsProvider>(
      builder: (context, goals, child) {
        final dailyGoal = goals.dailyGoal.target;
        return MiniStat(
          value: '${stats.todayPushups}',
          barValue: (stats.todayPushups / dailyGoal).clamp(0.0, 1.0),
          subtitle: '/ $dailyGoal',
          // ... other props
        );
      },
    )
    ```

    NOTE: GoalsProvider.dailyGoal returns a Goal object with `.target` property containing the int value.
  </action>
  <verify>Search home_screen.dart for "UserStatsProvider.dailyGoal" - should NOT exist. Search for "goals.dailyGoal.target" or "Consumer<GoalsProvider>" - should exist.</verify>
  <done>Home screen displays dynamic daily goal value from GoalsProvider, showing personalized goal (e.g., "0/20" instead of "0/50").</done>
</task>

</tasks>

<verification>
1. Run `flutter analyze` - no errors related to UserStatsProvider.dailyGoal
2. Verify no static `UserStatsProvider.dailyGoal` references exist in codebase
3. Check that GoalsProvider is imported in home_screen.dart (already is)
</verification>

<success_criteria>
1. UserStatsProvider has instance getter `dailyGoal` reading from storage
2. Home screen uses Consumer<GoalsProvider> for dynamic daily goal display
3. No hardcoded `static const int dailyGoal = 50` remains
4. Flutter analyze passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.6-bug-fixes-testing/04.6-01-SUMMARY.md`
</output>
