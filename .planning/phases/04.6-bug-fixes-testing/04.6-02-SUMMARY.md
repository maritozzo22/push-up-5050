---
phase: 04.6-bug-fixes-testing
plan: 02
subsystem: ui-workout
tags: [flutter, provider, storage-service, dynamic-validation]

# Dependency graph
requires:
  - phase: 04.3-goals-popup
    provides: StorageService.getDailyGoal() API, goals persistence
provides:
  - Dynamic series selection cap based on daily goal
  - Workout setup UI enforces sensible fitness-based limits
affects: [onboarding, user-experience]

# Tech tracking
tech-stack:
  added: []
  patterns: [dynamic-max-calculation, context-read-storage]

key-files:
  created: []
  modified:
    - push_up_5050/lib/screens/series_selection/series_selection_screen.dart

key-decisions:
  - "Series cap formula: (dailyGoal + 10).clamp(10, 99)"
  - "Dynamic cap calculated via context.read<StorageService>()"
  - "All series selection paths validate against dynamic max"

patterns-established:
  - "Dynamic max pattern: Calculate bounds from storage at runtime"
  - "Context-access pattern: Use BuildContext to read providers for dynamic values"

# Metrics
duration: 4min
completed: 2026-01-30
---

# Phase 04.6 Plan 02: Series Selection Cap Dynamic Calculation Summary

**Dynamic series selection cap calculated from daily goal value, preventing excessively long workouts that don't match user fitness level**

## Performance

- **Duration:** 4 min
- **Started:** 2025-01-30T19:47:21Z
- **Completed:** 2025-01-30T19:51:11Z
- **Tasks:** 2
- **Files modified:** 1

## Accomplishments

- Removed hardcoded `_maxStartingSeries = 99` constant
- Added `_getMaxStartingSeries(BuildContext context)` method that calculates cap as `(dailyGoal + 10).clamp(10, 99)`
- Updated series increment/decrement logic to respect dynamic cap
- Updated UI button handlers to disable plus button at max value
- Updated `_loadPreferences` to validate saved values against dynamic max

## Task Commits

Each task was committed atomically:

1. **Task 1: Add dynamic max series calculation method** - `287b773` (feat)
2. **Task 2: Update series increment logic to use dynamic cap** - `4fee7e0` (feat)

**Plan metadata:** (pending)

## Files Created/Modified

- `push_up_5050/lib/screens/series_selection/series_selection_screen.dart` - Added dynamic max calculation, updated increment/decrement methods and button handlers

## Decisions Made

- **Cap formula**: `(dailyGoal + 10).clamp(10, 99)` ensures user with 50 push-up goal can select up to 60 starting series, respecting both fitness level and absolute upper bound
- **Import addition**: Added `StorageService` import for `getDailyGoal()` access
- **Context requirement**: Method takes `BuildContext` parameter to access `context.read<StorageService>()`

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None - implementation proceeded smoothly.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Series selection now properly enforces daily goal + 10 cap
- Users cannot select starting series that would create excessively long workouts
- Dynamic cap automatically adjusts if daily goal changes
- Ready for next bug fix: 04.6-03 (Popup navigation after goal completion)

---
*Phase: 04.6-bug-fixes-testing*
*Plan: 02*
*Completed: 2026-01-30*
