# Plan 04.3-01: Goal Completion Popup Widget

**Wave:** 1
**Depends on:** None
**Files modified:**
- `push_up_5050/lib/widgets/goal_completion/goal_completion_dialog.dart` (create)

**Autonomous:** Yes

---

## Objective

Create the goal completion dialog widget that displays when daily push-up goal is achieved. The dialog uses a centered modal style with confetti celebration effects, Italian message, and a "Continua" button for dismissal.

## Context

@.planning/phases/04.3-goal-completion-popup/04.3-RESEARCH.md
@.planning/phases/04.3-goal-completion-popup/04.3-CONTEXT.md
@push_up_5050/lib/widgets/workout/goal_celebration.dart
@push_up_5050/lib/widgets/workout/achievement_popup.dart
@push_up_5050/lib/core/constants/app_colors.dart

## Tasks

<tasks>
### Task 1: Create goal_completion_dialog.dart widget

Create `push_up_5050/lib/widgets/goal_completion/goal_completion_dialog.dart` with:

1. **GoalCompletionDialog widget** (StatefulWidget):
   - `onDismiss` callback parameter (VoidCallback)
   - `disableAutoDismiss` parameter for testing (default: false)
   - Uses `Dialog` widget with transparent backgroundColor
   - Stack layout with confetti overlay + dialog content

2. **Confetti overlay**:
   - Reuse confetti particle system from `GoalCelebrationWidget`
   - Extract `_ConfettiWidget` and `ConfettiParticle` as shared classes or duplicate logic
   - 50 particles falling from top with random colors (orange, green, blue, purple, pink, yellow, cyan)

3. **Dialog content**:
   - Container: 320px width, rounded corners (20px), orange border (3px)
   - Title: "Complimenti!" (orange, 24px, bold)
   - Message: "Hai completato il tuo obiettivo di oggi.\nCi vediamo domani!" (white, 16px, centered)
   - Button: "Continua" (orange background, white text, triggers onDismiss)

4. **Auto-dismiss behavior**:
   - 5-second Timer (unless disableAutoDismiss is true)
   - Tap outside dismiss (barrierDismissible: true)
   - Button click dismiss

5. **Animation**:
   - Scale + fade entry animation using AnimationController
   - 300ms duration with Curves.elasticOut
   - Confetti particles animate throughout display

### Task 2: Create widget test for GoalCompletionDialog

Create `push_up_5050/test/widgets/goal_completion/goal_completion_dialog_test.dart` with:

1. **Widget test**:
   - Test that dialog renders with correct message text
   - Test that "Continua" button is present
   - Test that onDismiss callback is called when button is tapped
   - Test that auto-dismiss is disabled when disableAutoDismiss=true

### Task 3: Update exports (if needed)

Check `push_up_5050/lib/widgets/widgets.dart` or create export file for goal_completion widgets.

</tasks>

## Success Criteria

1. GoalCompletionDialog widget renders centered modal dialog
2. Confetti particles animate from top of screen
3. Italian message displays correctly
4. "Continua" button triggers onDismiss callback
5. Auto-dismisses after 5 seconds (unless disabled)
6. Tap outside dismisses dialog
7. Widget tests pass (4+ tests)

## must_haves

- Dialog uses showDialog pattern with barrierDismissible
- Confetti particles animate (50 particles, random colors from specified palette)
- Italian text exactly as specified: "Complimenti!" and "Hai completato il tuo obiettivo di oggi.\nCi vediamo domani!"
- "Continua" button with AppColors.primaryOrange background
- 5-second auto-dismiss Timer
- Widget tests for core behavior

## Verification

Run tests:
```bash
flutter test test/widgets/goal_completion/goal_completion_dialog_test.dart
```

Manual verification:
- Build and show dialog using test route
- Verify confetti animation plays
- Verify auto-dismiss after 5 seconds
- Verify tap-outside dismissal
- Verify button text and message text are correct Italian
