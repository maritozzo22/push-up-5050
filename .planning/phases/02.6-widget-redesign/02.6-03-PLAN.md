---
phase: 02.6-widget-redesign
plan: 03
type: execute
wave: 3
depends_on: [02.6-01, 02.6-02]
files_modified:
  - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt
  - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt
  - push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start.xml
  - push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start_small.xml
  - push_up_5050/android/app/src/main/res/drawable/day_indicator_glow.xml
  - push_up_5050/android/app/src/main/res/drawable/streak_connector.xml
autonomous: true
user_setup: []

must_haves:
  truths:
    - "4x4 Quick Start widget displays 7-day calendar row with Italian labels (L M M G V S D)"
    - "Completed days show as orange circles with glow effect"
    - "Consecutive completed days show connecting glow line"
    - "Missed days show as red outline with centered X mark"
    - "2x1 Small widget displays 3-day calendar (Yesterday-Today-Tomorrow)"
    - "Both widgets read calendar data from weekDayData/threeDayData in JSON"
    - "Widgets update within 5 seconds after app state changes"
  artifacts:
    - path: "push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt"
      provides: "4x4 widget with 7-day calendar rendering"
      modifies: "updateAppWidget() companion method"
    - path: "push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt"
      provides: "2x1 widget with 3-day calendar rendering"
      modifies: "updateAppWidget() companion method"
    - path: "push_up_5050/android/app/src/main/res/drawable/day_indicator_glow.xml"
      provides: "Orange glow effect for completed days"
    - path: "push_up_5050/android/app/src/main/res/drawable/streak_connector.xml"
      provides: "Glowing line between consecutive completed days"
  key_links:
    - from: "PushupWidgetQuickStartProvider"
      to: "WidgetData.weekDayData"
      via: "JSON parsing from home_widget storage"
      pattern: "json\\.getJSONArray\\(\"weekDayData\"\\)"
    - from: "PushupWidgetSmallProvider"
      to: "WidgetData.threeDayData"
      via: "JSON parsing from home_widget storage"
      pattern: "json\\.getJSONArray\\(\"threeDayData\"\\)"
    - from: "Widget providers"
      to: "MainActivity"
      via: "PendingIntent deep link"
      pattern: "pushup5050://series_selection"
---

<objective>
Update Android Widget Providers with Calendar Rendering

Purpose: Modify existing Android widget providers to render the new calendar UI with day indicators, glow effects, and streak lines

Output: Updated widget providers and layouts with full calendar visualization
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.6-widget-redesign/02.6-CONTEXT.md
@.planning/phases/02.6-widget-redesign/02.6-01-SUMMARY.md
@.planning/phases/02.6-widget-redesign/02.6-02-SUMMARY.md
@push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt
@push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt
@push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start.xml
@push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start_small.xml
@push_up_5050/lib/models/widget_data.dart
@New-design.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create drawable resources for calendar day indicators</name>
  <files>
    push_up_5050/android/app/src/main/res/drawable/day_indicator_glow.xml,
    push_up_5050/android/app/src/main/res/drawable/streak_connector.xml,
    push_up_5050/android/app/src/main/res/drawable/day_indicator_missed_new.xml
  </files>
  <action>
    Create drawable resources matching the New-design.md orange glow style:

    1. **day_indicator_glow.xml** (new, for completed days):
       - Shape: oval (circle)
       - Size: 24dp x 24dp
       - Gradient: radial or linear #FFB347 -> #FF5F1F
       - Glow: outer shadow with #FF7A18 color, blur 38dp, spread 10dp
       - Use layer-list for gradient + shadow effect

    2. **streak_connector.xml** (new, connecting line):
       - Shape: rectangle (horizontal line)
       - Height: 4dp
       - Width: matches spacing between day circles (approx 20-30dp)
       - Color: #FF7A18 with glow effect
       - Use shape with gradient for glowing appearance

    3. **day_indicator_missed_new.xml** (replace existing):
       - Shape: oval with stroke only (no fill)
       - Stroke: 2dp, color #F44336 (red)
       - Background: transparent
       - No glow effect

    Reference existing drawables: circular_day_button_completed, day_indicator_completed
    Match app's design system colors from AppColors (#FF6B00 primary orange)
  </action>
  <verify>
    flutter build apk --debug
    APK builds without resource errors
  </verify>
  <done>
    All drawable resources created for calendar day states
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PushupWidgetQuickStartProvider with 7-day calendar</name>
  <files>push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt</files>
  <action>
    Modify PushupWidgetQuickStartProvider to display 7-day calendar row:

    1. Parse weekDayData from JSON (instead of using streak-based day buttons):
       ```kotlin
       val weekDayDataArray = json.optJSONArray("weekDayData")
       val weekDays = mutableListOf<WeekDayInfo>() // day, status, pushups, isPartOfStreak
       // Parse each day: day (int), status (string: completed/missed/pending), isPartOfStreak (bool)
       ```

    2. Create data class WeekDayInfo:
       ```kotlin
       data class WeekDayInfo(
           val day: Int,
           val dayLabel: String,  // L, M, M, G, V, S, D
           val status: String,    // completed, missed, pending, today
           val isPartOfStreak: Boolean
       )
       ```

    3. Update day button rendering (7 buttons in layout):
       - For each day in weekDayData:
         * Set background based on status (completed=glow, missed=red outline, pending=gray)
         * Set text to dayLabel (L, M, M, G, V, S, D)
         * Show/hide streak connector based on isPartOfStreak

    4. Add hasStreakLine check to show/hide connecting lines between completed days

    5. Keep existing stats display (today/total pushups)
    6. Keep existing START button deep link functionality

    Remove old streak-based logic (day 1-7 based on streakDays).
    Use JSON weekDayData for authoritative calendar state.
  </action>
  <verify>
    flutter build apk --debug
    APK builds, no syntax errors
  </verify>
  <done>
    4x4 widget reads weekDayData and renders 7-day calendar with Italian labels
  </done>
</task>

<task type="auto">
  <name>Task 3: Update PushupWidgetSmallProvider with 3-day calendar</name>
  <files>push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt</files>
  <action>
    Modify PushupWidgetSmallProvider to display 3-day calendar (Yesterday-Today-Tomorrow):

    1. Parse threeDayData from JSON:
       ```kotlin
       val threeDayDataArray = json.optJSONArray("threeDayData")
       // Expect 3 entries: [yesterday, today, tomorrow]
       ```

    2. Update day indicator rendering (3 indicators in layout):
       - day_yesterday: Use threeDayData[0] for status and label
       - day_today: Use threeDayData[1] for status and label
       - day_tomorrow: Use threeDayData[2] for status and label (always pending)

    3. Status-based rendering:
       - completed: day_indicator_glow + checkmark or day number
       - missed: day_indicator_missed_new + X mark
       - pending/today_in_progress: day_indicator_pending (gray or orange border)

    4. Keep existing stats display (today count, total count)
    5. Keep existing deep link on tap

    Remove old yesterday/today/tomorrow calculation logic (now authoritative from JSON).
    Use threeDayData for all calendar state.
  </action>
  <verify>
    flutter build apk --debug
    APK builds, no syntax errors
  </verify>
  <done>
    2x1 widget reads threeDayData and renders 3-day calendar correctly
  </done>
</task>

<task type="auto">
  <name>Task 4: Update widget layouts for calendar display</name>
  <files>
    push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start.xml,
    push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start_small.xml
  </files>
  <action>
    Update XML layouts to support new calendar visualization:

    **pushup_widget_quick_start.xml** (4x4 widget):
    1. Add container for 7-day calendar row below existing day buttons
    2. Layout structure:
       - Horizontal LinearLayout for calendar row
       - 7 ImageView elements for streak connectors (between days)
       - 7 TextView elements for day circles (L M M G V S D)
       - Use wrap_content with fixed 24dp size for day circles
    3. Style:
       - Center all elements
       - 8dp spacing between day circles
       - Align calendar row below START button
    4. IDs: calendar_row, day_0 through day_6, connector_0 through connector_5

    **pushup_widget_quick_start_small.xml** (2x1 widget):
    1. Update existing 3 day indicators to use new drawable resources
    2. Ensure day_yesterday, day_today, day_tomorrow TextViews are properly sized
    3. Add placeholder for X mark on missed days (hidden by default)
    4. Style:
       - 24dp day circles
       - Orange glow for completed
       - Red outline + X for missed
       - Gray for pending

    Keep existing background, stats display, and START button (large widget only).
    Only modify calendar day sections.
  </action>
  <verify>
    flutter build apk --debug
    APK builds, layout resources valid
  </verify>
  <done>
    Widget layouts support 7-day and 3-day calendar visualization
  </done>
</task>

<task type="auto">
  <name>Task 5: Add integration tests for calendar widget rendering</name>
  <files>push_up_5050/integration_test/widget_calendar_integration_test.dart</files>
  <action>
    Create integration tests for calendar widget functionality:

    1. test_widgetData_containsWeekDayData:
       - Verify WidgetData serializes weekDayData to JSON
       - Verify JSON contains all required fields (day, dayLabel, status, isPartOfStreak)

    2. test_widgetData_containsThreeDayData:
       - Verify WidgetData serializes threeDayData to JSON
       - Verify 3 entries exist (yesterday, today, tomorrow)

    3. test_widgetUpdateService_includesCalendarData:
       - Mock WidgetCalendarService
       - Verify updateAllWidgets() includes calendar data in saved JSON

    4. test_userStatsProvider_updatesWidgetsWithCalendar:
       - Load mock daily records
       - Trigger loadStats()
       - Verify calendar service integration produces correct WeekDayData

    Use existing integration test patterns from widget_update_integration_test.dart.
    Verify JSON structure matches what Android providers expect.
  </action>
  <verify>
    flutter test integration_test/widget_calendar_integration_test.dart
    All integration tests pass
  </verify>
  <done>
    Calendar widget integration verified end-to-end
  </done>
</task>

</tasks>

<verification>
1. Widget APK builds without errors
2. 4x4 widget displays 7-day calendar with Italian labels
3. 2x1 widget displays 3-day calendar
4. Completed days show orange glow
5. Missed days show red outline with X
6. Streak lines appear between consecutive completed days
7. Integration tests verify calendar data flow
</verification>

<success_criteria>
- Android widget providers render calendar from JSON data
- Day indicators match design spec (orange glow, red X, gray pending)
- Streak lines connect consecutive completed days
- Integration tests verify full data flow
- Ready for WorkManager midnight update in next plan
</success_criteria>

<output>
After completion, create `.planning/phases/02.6-widget-redesign/02.6-03-SUMMARY.md`
</output>
