# Phase 2.7: Widget Rebuild from Templates - Context

**Gathered:** 2026-01-22
**Status:** Ready for planning

<domain>
## Phase Boundary

Rebuild Android home screen widgets (4x4 and 2x1) from scratch to exactly match the provided Flutter template designs. Previous widget work (Phase 2.6) is rejected due to missing widgets, incorrect sizes, and non-functional implementations.

**What to keep:** WidgetCalendarService, WidgetData model, pushup data sync, deep link handling, update mechanism
**What to rebuild:** XML layouts, drawable resources, widget providers, size registration

</domain>

<decisions>
## Implementation Decisions

### Widget Sizing
- Use **cell-based sizing** (targetCellWidth/targetCellHeight) as primary method
- **4x4 widget**: targetCellWidth="4" targetCellHeight="4" (fallback to 3x3 if too large)
- **2x1 widget**: targetCellWidth="2" targetCellHeight="1"
- **Fixed size only**: resizeMode="none" (no resizing - templates are fixed aspect)
- minWidth/minHeight fallback: Claude's discretion based on template requirements

### Visual Fidelity
- **Exact template match required** - all visual elements from Flutter templates must be replicated
- **Exact hex colors**: #F46A1E (orange), #EF7A1A (orange2), #20262B (topA), #111416 (topB), #0F1113 (bottomA), #0B0D0F (bottomB), #B9C0C7 (textSoft)
- **Curved edge panel**: The top panel with quadraticBezier curved bottom edge must be replicated
- **Effects implementation**: Claude's discretion (XML drawables vs PNG assets for gradients, noise, glow)

### Calendar Display
- **4x4 widget**: Show current week (Monday-Sunday), 7 days, labels L M M G V S D (Italian) or M T W T F S S (English based on app locale)
- **2x1 widget**: Show 3 days with single-letter day labels (L-M-M or M-T-W based on locale)
- **3-state visual system**:
  - Completed: Orange with glow effect, white text
  - Pending: Gray background, white text
  - Missed: Red outline with X mark, white text
- **Text color**: Always white for day labels on any background

### Data Edge Cases
- **Empty state** (no workouts ever): Show zeros (0) for counts, gray circles for all days, appropriate labels
- **No data on init**: Request data from app when widget is first added
- **Malformed JSON**: Graceful degradation - skip update, keep last known data, no crash
- **Update frequency**: Keep 30 minutes (updatePeriodMillis="1800000")

### Claude's Discretion
- Exact minWidth/minHeight dp values for fallback compatibility
- Visual effects implementation (XML layer-list vs PNG assets)
- Specific error handling for malformed JSON beyond graceful degradation
- Preview image design for widget picker

</decisions>

<specifics>
## Specific Ideas

**Template files to replicate exactly:**
- `template-widget 4x4.md` - Full Flutter widget code with Pushup5050Widget design
- `template-widget 2x1.md` - Full Flutter widget code with Pushup5050SmallWidget design

**Key visual elements from 4x4 template:**
- Top panel with gradient (#20262B to #111416) and curved bottom edge
- Stats section: OGGI (left), OBIETTIVO (right)
- Large circular START button with gradient orange (#EF7A1A to #F46A1E) and glow
- 7-day row at bottom with day chips
- Noise grid pattern overlay (opacity 0.10)

**Key visual elements from 2x1 template:**
- Top panel (62% height) with gradient background
- Centered stats: OGGI PUSHUPS + TOTALE PUSHUPS
- Total displayed as 3 lines: "44 / 5050"
- 3-day row at bottom (yesterday-today-tomorrow)

**Localization requirement:**
- Day labels (L M M G V S D) must change based on app locale (Italian/English)
- Widget labels (OGGI/OBIETTIVO or TODAY/OBJECTIVE) must respect app locale

</specifics>

<deferred>
## Deferred Ideas

None - discussion stayed within phase scope.

</deferred>

---

*Phase: 02.7-widget-rebuild-from-templates*
*Context gathered: 2026-01-22*
