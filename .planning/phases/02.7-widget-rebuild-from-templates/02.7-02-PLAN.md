---
phase: 02.7-widget-rebuild-from-templates
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - push_up_5050/android/app/src/main/res/layout/pushup_widget_4x4.xml
  - push_up_5050/android/app/src/main/res/layout/pushup_widget_2x1.xml
  - push_up_5050/android/app/src/main/res/xml/pushup_widget_4x4_info.xml
  - push_up_5050/android/app/src/main/res/xml/pushup_widget_2x1_info.xml
autonomous: true
user_setup: []

must_haves:
  truths:
    - "4x4 widget layout has 4 vertical sections: top stats panel, START button, empty spacer, 7-day row"
    - "4x4 widget info file declares targetCellWidth=4 targetCellHeight=4"
    - "2x1 widget layout has centered stats (OGGI PUSHUPS large, TOTALE PUSHUPS 3-line) and 3-day row"
    - "2x1 widget info file declares targetCellWidth=2 targetCellHeight=1"
    - "Both layouts use new drawable resources from Plan 01"
    - "View IDs match provider expectations (today_count, total_count, day_* for 4x4, day_yesterday_*, day_today_*, day_tomorrow_* for 2x1)"
  artifacts:
    - path: push_up_5050/android/app/src/main/res/layout/pushup_widget_4x4.xml
      provides: "4x4 widget layout matching template structure"
      contains: "start_button_container, today_count, total_count, day_1 through day_7"
      min_lines: 80
    - path: push_up_5050/android/app/src/main/res/layout/pushup_widget_2x1.xml
      provides: "2x1 widget layout with centered stats and 3-day view"
      contains: "today_count, total_count_3line, day_yesterday_bg, day_today_bg, day_tomorrow_bg"
      min_lines: 60
    - path: push_up_5050/android/app/src/main/res/xml/pushup_widget_4x4_info.xml
      provides: "4x4 widget size registration (4x4 cells)"
      contains: "targetCellWidth=4, targetCellHeight=4"
    - path: push_up_5050/android/app/src/main/res/xml/pushup_widget_2x1_info.xml
      provides: "2x1 widget size registration (2x1 cells)"
      contains: "targetCellWidth=2, targetCellHeight=1"
  key_links:
    - from: pushup_widget_4x4.xml
      to: PushupWidgetQuickStartProvider
      via: "View ID matching for data binding"
      pattern: "R.id.today_count|R.id.total_count|R.id.day_\\d"
    - from: pushup_widget_2x1.xml
      to: PushupWidgetSmallProvider
      via: "View ID matching for 3-day data binding"
      pattern: "R.id.day_yesterday|R.id.day_today|R.id.day_tomorrow"
    - from: pushup_widget_4x4_info.xml
      to: AndroidManifest.xml
      via: "Widget size registration"
      pattern: "targetCellWidth.*4"
    - from: template-widget 4x4.md
      to: pushup_widget_4x4.xml
      via: "Layout structure replication"
      pattern: "Stack.*Positioned.*topH.*startD"
---

<objective>
Create XML layouts for both widgets that exactly match template structure and register correct widget sizes.

Purpose: Current layouts don't match templates (wrong proportions, missing elements). Widget 4x4 needs correct 4x4 size registration (currently 2x2). Both layouts need to reference new drawable resources and preserve existing provider data bindings.

Output: Two new layout files and two updated widget info files with correct sizes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02.7-widget-rebuild-from-templates/02.7-CONTEXT.md
@template-widget 4x4.md
@template-widget 2x1.md
@push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start.xml
@push_up_5050/android/app/src/main/res/layout/pushup_widget_quick_start_small.xml
@push_up_5050/android/app/src/main/res/xml/pushup_widget_quick_start_info.xml
@push_up_5050/android/app/src/main/res/xml/pushup_widget_small_info.xml
@push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt
@push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create 4x4 widget layout</name>
  <files>push_up_5050/android/app/src/main/res/layout/pushup_widget_4x4.xml</files>
  <action>
    Create pushup_widget_4x4.xml matching template structure:

    Root element: FrameLayout with widget_4x4_background
    - layout_width/height: match_parent
    - padding: 0 (background has built-in padding via shadow)

    Child structure (vertical Stack equivalent):
    1. Top panel (58% of inner height): widget_4x4_top_panel
       - Position at top, full width, ~58% height

    2. Stats section (overlay on top panel):
       - Left column (46% of width): "OGGI:" label, today count value, "push-ups" unit
       - Right column (46% of width): "OBIETTIVO:" label, total/goal value, "push-ups" unit
       - Use LinearLayout for each column with gravity left/right
       - View IDs: today_count, total_count (must match provider)

    3. START button (center, overlapping panel boundary):
       - FrameLayout id="start_button_container" (for click handling)
       - ImageView with widget_4x4_start_button
       - Size: 40% of widget width/height, centered
       - TextView "START" centered on top (white, bold, 2.0 letter spacing)

    4. 7-day row (bottom):
       - LinearLayout horizontal, space-between
       - 7 TextViews/Buttons with day labels L M M G V S D
       - View IDs: day_1 through day_7 (must match provider)
       - Each uses widget_day_chip_completed/pending/missed drawable
       - Size: ~11% of widget width (clamped 34-62dp)

    IMPORTANT: Preserve existing view IDs so provider code works without changes:
    - R.id.today_count (for today's pushups)
    - R.id.total_count (for total/goal display)
    - R.id.start_button_container (for deep link click)
    - R.id.day_1 through R.id.day_7 (for calendar indicators)

    Reference template-widget 4x4.md lines 54-167 for layout proportions
  </action>
  <verify>File exists with all required view IDs, uses @drawable/widget_4x4_* resources, has 4 vertical sections matching template</verify>
  <done>4x4 widget layout ready for provider integration with exact template structure</done>
</task>

<task type="auto">
  <name>Task 2: Create 2x1 widget layout</name>
  <files>push_up_5050/android/app/src/main/res/layout/pushup_widget_2x1.xml</files>
  <action>
    Create pushup_widget_2x1.xml matching template structure:

    Root element: FrameLayout with widget_2x1_background
    - layout_width/height: match_parent

    Child structure:
    1. Top panel (62% of height): widget_2x1_top_panel
       - Position at top, full width, 62% height

    2. Stats section (centered on top panel):
       - Column with gravity center_horizontal
       - First block: "OGGI PUSHUPS" heading (orange), large today value below
       - Spacer: 10-22dp between blocks
       - Second block: "TOTALE PUSHUPS" heading (orange), 3-line total below (44 / 5050 format)
       - View IDs: today_count, total_count (preserve for provider)

    3. 3-day row (bottom area):
       - LinearLayout horizontal, center-aligned
       - 3 FrameLayouts for yesterday/today/tomorrow
       - Each has: ImageView background (day chip), TextView overlay (label or checkmark/X)
       - View IDs: day_yesterday_bg, day_yesterday_text, day_today_bg, day_today_text, day_tomorrow_bg, day_tomorrow_text
       - Uses widget_2x1_day_chip selector

    4. Day labels row (optional, for clarity):
       - "IERI" "OGGI" "DOMANI" text below day chips
       - Gray color, small text

    IMPORTANT: Preserve existing view IDs for provider compatibility:
    - R.id.today_count (for today's pushups)
    - R.id.total_count (for total/goal display)
    - R.id.day_yesterday_bg, R.id.day_yesterday_text
    - R.id.day_today_bg, R.id.day_today_text
    - R.id.day_tomorrow_bg, R.id.day_tomorrow_text

    Reference template-widget 2x1.md lines 42-158 for layout proportions
  </action>
  <verify>File exists with all required view IDs, uses @drawable/widget_2x1_* resources, has centered stats matching template</verify>
  <done>2x1 widget layout ready for provider integration with exact template structure</done>
</task>

<task type="auto">
  <name>Task 3: Create/update widget info files with correct sizes</name>
  <files>
    push_up_5050/android/app/src/main/res/xml/pushup_widget_4x4_info.xml
    push_up_5050/android/app/src/main/res/xml/pushup_widget_2x1_info.xml
  </files>
  <action>
    Create/update two appwidget-provider XML files:

    1. pushup_widget_4x4_info.xml (new file):
       - targetCellWidth="4" targetCellHeight="4" (CRITICAL: fixes the 2x2 bug)
       - minWidth="250dp" minHeight="250dp" (fallback for pre-API 12)
       - updatePeriodMillis="1800000" (30 minutes)
       - initialLayout="@layout/pushup_widget_4x4"
       - resizeMode="none" (fixed size, no resizing)
       - widgetCategory="home_screen"
       - previewImage="@drawable/pushup_widget_preview" (reuse existing)

    2. pushup_widget_2x1_info.xml (update existing pushup_widget_small_info.xml):
       - targetCellWidth="2" targetCellHeight="1" (already correct)
       - minWidth="146dp" minHeight="66dp" (fallback)
       - updatePeriodMillis="1800000"
       - initialLayout="@layout/pushup_widget_2x1" (point to new layout)
       - resizeMode="none"
       - widgetCategory="home_screen"

    Note: resizeMode="none" prevents widget from being resized (templates are fixed aspect)
  </action>
  <verify>pushup_widget_4x4_info.xml has targetCellWidth=4 targetCellHeight=4, pushup_widget_2x1_info.xml has targetCellWidth=2 targetCellHeight=1</verify>
  <done>Widget size registration correct - 4x4 will appear as 4x4 in picker, 2x1 will appear as 2x1</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. pushup_widget_4x4.xml exists with correct view IDs and layout structure
2. pushup_widget_2x1.xml exists with correct view IDs and layout structure
3. pushup_widget_4x4_info.xml declares targetCellWidth=4 targetCellHeight=4
4. pushup_widget_2x1_info.xml declares targetCellWidth=2 targetCellHeight=1
5. Both layouts reference new drawable resources (widget_4x4_*, widget_2x1_*)
6. All view IDs match existing provider expectations
</verification>

<success_criteria>
1. Layouts match template visual structure (4 sections for 4x4, centered stats for 2x1)
2. Widget size registration is correct (4x4 and 2x1)
3. View IDs are preserved for provider compatibility
4. Ready for provider update (Plan 03)
</success_criteria>

<output>
After completion, create `.planning/phases/02.7-widget-rebuild-from-templates/02.7-02-SUMMARY.md`
</output>
