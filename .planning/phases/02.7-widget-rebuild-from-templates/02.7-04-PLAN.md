---
phase: 02.7-widget-rebuild-from-templates
plan: 04
type: execute
wave: 2
depends_on: [02.7-01, 02.7-02, 02.7-03]
files_modified:
  - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetQuickStartProvider.kt
  - push_up_5050/android/app/src/main/kotlin/com/pushup5050/push_up_5050/widget/PushupWidgetSmallProvider.kt
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Both widgets appear in Android widget picker with correct sizes (4x4 and 2x1)"
    - "Widget 4x4 displays visually matching template (gradients, curved edge, START button, 7-day row)"
    - "Widget 2x1 displays visually matching template (centered stats, 3-day row)"
    - "START button opens app to SeriesSelectionScreen (deep link works)"
    - "Calendar day indicators show correct states (completed=orange, missed=red, pending=gray)"
    - "Widget data updates within 5 seconds of app state changes"
  artifacts:
    - path: .planning/phases/02.7-widget-rebuild-from-templates/02.7-04-VERIFICATION.md
      provides: "Verification report with screenshots and test results"
      contains: "visual_match, size_correct, deep_link_works, data_sync_works"
  key_links:
    - from: user verification
      to: templates
      via: "Visual comparison"
      pattern: "template.*widget.*match"
    - from: widget picker
      to: pushup_widget_4x4_info.xml
      via: "Size registration verification"
      pattern: "targetCellWidth.*4"
    - from: START button tap
      to: MainActivity
      via: "Deep link navigation"
      pattern: "pushup5050://series_selection"
---

<objective>
Build, deploy, and verify both widgets on physical Android device or emulator.

Purpose: Plans 01-03 create the widget infrastructure. This plan validates everything works: widgets appear in picker with correct sizes, visual design matches templates, deep links function, and data sync works. Requires human verification for visual checks.

Output: Verification report with test results, visual comparison, and any issues found.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02.7-widget-rebuild-from-templates/02.7-CONTEXT.md
@.planning/phases/02.7-widget-rebuild-from-templates/02.7-01-SUMMARY.md
@.planning/phases/02.7-widget-rebuild-from-templates/02.7-02-SUMMARY.md
@.planning/phases/02.7-widget-rebuild-from-templates/02.7-03-SUMMARY.md
@template-widget 4x4.md
@template-widget 2x1.md
@push_up_5050/lib/services/widget_update_service.dart
@push_up_5050/lib/services/widget_calendar_service.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Android APK with new widgets</name>
  <files>push_up_5050/android/app/build.gradle</files>
  <action>
    Build the Android app to verify widget resources compile correctly:

    1. Clean build artifacts:
       flutter clean

    2. Get dependencies:
       flutter pub get

    3. Build Android APK (debug):
       flutter build apk --debug

    4. Check build output for errors:
       - XML validation errors in layouts/drawables
       - Missing resource errors (@color/widget_*, @drawable/widget_*)
       - Duplicate resource errors

    If build fails:
    - Fix XML syntax errors
    - Fix resource reference errors
    - Rebuild until successful

    If build succeeds:
    - Note APK location (usually build/app/outputs/flutter-apk/app-debug.apk)
    - Proceed to deployment
  </action>
  <verify>flutter build apk --debug completes successfully with no errors, APK file exists in build/app/outputs/flutter-apk/</verify>
  <done>Android APK builds successfully with new widget resources</done>
</task>

<task type="auto">
  <name>Task 2: Deploy and verify widget registration</name>
  <files>push_up_5050/android/app/build.gradle</files>
  <action>
    Deploy app to connected Android device and verify widget registration:

    1. Connect Android device or start emulator
    2. Verify device connection:
       flutter devices

    3. Install app:
       flutter install

    4. Trigger widget update from Flutter side:
       - Open app
       - Navigate to HomeScreen
       - Complete a few push-ups (or use existing data)
       - Wait 5 seconds for widget data to save

    5. Check widget picker:
       - Long press home screen
       - Tap "Widgets"
       - Search for "Pushup 5050" or "push_up_5050"
       - Verify BOTH widgets appear:
         * Widget 4x4 (large square)
         * Widget 2x1 (wide rectangle)
       - Verify sizes are correct (4x4 takes 4x4 cells, 2x1 takes 2x1 cells)

    If widgets don't appear:
    - Check logcat for widget registration errors
    - Verify AndroidManifest has enabled="true" for both receivers
    - Verify widget info files exist and have no XML errors

    Save a screenshot of the widget picker showing both widgets with correct sizes.
  </action>
  <verify>Both widgets appear in widget picker, sizes are correct (4x4 and 2x1), app installs without errors</verify>
  <done>Widgets registered and visible in picker with correct sizes</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete widget rebuild with new layouts, drawables, and providers</what-built>
  <how-to-verify>
    1. Add 4x4 widget to home screen
    2. Compare visually with template-widget 4x4.md:
           - Top panel has gradient (#20262B to #111416) with curved bottom edge
           - OGGI stats on left, OBIETTIVO stats on right
           - Large circular START button with gradient orange (#EF7A1A to #F46A1E)
           - 7-day row at bottom (L M M G V S D) with colored day chips
    3. Tap START button - verify app opens to SeriesSelectionScreen
    4. Add 2x1 widget to home screen
    5. Compare visually with template-widget 2x1.md:
           - Top panel (62% height) with gradient
           - Centered stats: OGGI PUSHUPS (large), TOTALE PUSHUPS (3-line)
           - 3-day row at bottom
    6. Verify data sync:
           - Complete some push-ups in the app
           - Wait 5 seconds
           - Check widget displays updated count
    7. Verify calendar states (if you have historical data):
           - Completed days: orange with glow
           - Missed days: red with X
           - Pending/future: gray

    Take screenshots of both widgets on home screen for documentation.
  </how-to-verify>
  <resume-signal>Type "approved" if both widgets match templates and all functionality works, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
After human verification:
1. Widget picker shows both widgets
2. Visual design matches templates (colors, gradients, layout proportions)
3. START button deep link works
4. Data syncs from app to widgets within 5 seconds
5. Calendar shows correct states
6. No crashes or errors in logcat
</verification>

<success_criteria>
1. Both widgets appear in picker with correct sizes
2. Visual design matches templates exactly
3. START button opens SeriesSelectionScreen
4. Widget data updates when app data changes
5. Calendar indicators show correct states
</success_criteria>

<output>
After completion, create `.planning/phases/02.7-widget-rebuild-from-templates/02.7-04-VERIFICATION.md`
</output>
