---
phase: 11-android-notifications-fix
plan: 04
type: execute
wave: 4
depends_on: [11-03]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Daily reminder notification arrives at configured time on physical Android device"
    - "Scheduled notifications persist after device reboot"
    - "User is prompted for POST_NOTIFICATIONS permission on first launch (Android 13+)"
    - "User is shown exact alarm guidance when scheduling first notification (Android 12+)"
    - "All notification types (daily, streak, progress, weekly) work correctly"
  artifacts: []
  key_links: []
---

<objective>
Verify all notification functionality works correctly on a physical Android device.

Purpose: Notification functionality cannot be reliably tested on emulator, web, or Windows. This plan requires testing on a physical Android device to confirm all fixes from previous plans work correctly in real-world conditions.

Output: Verified working notifications on Android 12+ and Android 13+ physical devices.
</objective>

<execution_context>
@C:\Users\olegn\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\olegn\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-android-notifications-fix/11-CONTEXT.md
@.planning/phases/11-android-notifications-fix/11-RESEARCH.md
@.planning/phases/11-android-notifications-fix/11-01-SUMMARY.md
@.planning/phases/11-android-notifications-fix/11-02-SUMMARY.md
@.planning/phases/11-android-notifications-fix/11-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Android notification fix implementation including:
    - Package updated to flutter_local_notifications v20.0.0
    - Broadcast receivers added to AndroidManifest.xml
    - POST_NOTIFICATIONS permission request on startup
    - Exact alarm permission dialog with settings button
    - Permission status display in Settings screen
  </what-built>
  <how-to-verify>
    **Prerequisites:**
    - Physical Android device (Android 12+ recommended, Android 13+ for POST_NOTIFICATIONS testing)
    - Device connected via ADB or build APK and install

    **Test Steps:**

    1. **Build and Install:**
       - Run: flutter build apk --release
       - Install APK on physical Android device
       - OR run: flutter run -d [device-id]

    2. **First Launch - POST_NOTIFICATIONS Permission (Android 13+):**
       - Launch the app
       - EXPECTED: Permission dialog appears asking for notification permission
       - Grant permission
       - Open Settings screen
       - VERIFY: "Notifiche Attivate" status shown in green

    3. **Schedule Daily Reminder:**
       - Open Settings
       - Enable "Promemoria Giornaliero"
       - Set reminder time 2 minutes from now
       - Wait for the reminder
       - EXPECTED: Notification appears at configured time with title "Non perdere la tua serie!"

    4. **Exact Alarm Permission (Android 12+):**
       - If notification didn't appear, check:
         - Android Settings → Apps → Push-Up 5050 → Special app access → Alarms and reminders
         - VERIFY: "Allow exact alarms" is enabled

    5. **Test Scheduled Test Notification:**
       - Open Settings
       - Use any test notification option (if available)
       - EXPECTED: Test notification appears immediately

    6. **Boot Persistence Test:**
       - Schedule a daily reminder for a future time
       - Restart the device (power off and on)
       - AFTER reboot, wait for scheduled time
       - EXPECTED: Notification still fires (broadcast receivers working)

    7. **Permission Denial Test:**
       - Go to Android Settings → Apps → Push-Up 5050 → Notifications
       - Turn OFF notifications
       - Open app, go to Settings
       - VERIFY: Status shows "Notifiche Disattivate" in red
       - Tap "Richiedi Autorizzazione" button
       - EXPECTED: App redirects to system notification settings
       - Enable notifications in system settings
       - Return to app
       - VERIFY: Status changes to "Notifiche Attivate"

    8. **Smart Notifications Test (if accessible):**
       - Complete a workout to trigger notification scheduling
       - Check if streak/progress notifications are scheduled
       - Use debug methods to verify pending notifications
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe which tests failed</resume-signal>
</task>

</tasks>

<verification>
After checkpoint approval:
- [ ] Daily reminder notification arrives at configured time
- [ ] POST_NOTIFICATIONS permission requested on first launch (Android 13+)
- [ ] Exact alarm guidance shown when needed
- [ ] Notifications persist after device reboot
- [ ] Settings screen shows correct permission status
- [ ] Re-request button opens system settings
</verification>

<success_criteria>
All scheduled notifications work reliably on Android physical device with proper permission handling.
</success_criteria>

<output>
After completion, create `.planning/phases/11-android-notifications-fix/11-04-SUMMARY.md`
</output>
