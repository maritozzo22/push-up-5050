---
phase: 11-android-notifications-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pubspec.yaml
  - android/app/src/main/AndroidManifest.xml
autonomous: true

must_haves:
  truths:
    - "flutter_local_notifications package updated to v20.0.0"
    - "AndroidManifest.xml contains ScheduledNotificationBootReceiver"
    - "AndroidManifest.xml contains ScheduledNotificationReceiver"
    - "All required intent-filters for boot completion are present"
  artifacts:
    - path: "pubspec.yaml"
      contains: "flutter_local_notifications: ^20.0.0"
    - path: "android/app/src/main/AndroidManifest.xml"
      contains: "ScheduledNotificationBootReceiver"
      contains: "ScheduledNotificationReceiver"
      contains: "BOOT_COMPLETED"
      contains: "MY_PACKAGE_REPLACED"
  key_links:
    - from: "android/app/src/main/AndroidManifest.xml"
      to: "flutter_local_notifications plugin"
      via: "ScheduledNotificationBootReceiver broadcast receiver"
      pattern: "com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver"
---

<objective>
Update notification package and add broadcast receivers to AndroidManifest.xml for notification persistence after device reboot.

Purpose: The current flutter_local_notifications v17.2.3 lacks proper Android 14+ support. Additionally, the AndroidManifest.xml is missing the broadcast receivers required for scheduled notifications to persist after device reboot.

Output: Updated package with v20.0.0 and AndroidManifest.xml with proper broadcast receivers.
</objective>

<execution_context>
@C:\Users\olegn\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\olegn\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-android-notifications-fix/11-CONTEXT.md
@.planning/phases/11-android-notifications-fix/11-RESEARCH.md
@pubspec.yaml
@android/app/src/main/AndroidManifest.xml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update flutter_local_notifications to v20.0.0</name>
  <files>pubspec.yaml</files>
  <action>
    1. Open pubspec.yaml
    2. Find the line: flutter_local_notifications: ^17.2.3
    3. Update to: flutter_local_notifications: ^20.0.0
    4. Save the file

    NOTE: v20.0.0 requires compileSdk 35+. The build.gradle.kts uses flutter.compileSdkVersion which should be 35+ in recent Flutter versions.

    DO NOT modify any other dependencies.
  </action>
  <verify>flutter pub get completes without errors and pubspec.lock shows flutter_local_notifications 20.0.0</verify>
  <done>Package updated successfully, flutter pub get runs clean</done>
</task>

<task type="auto">
  <name>Task 2: Add broadcast receivers to AndroidManifest.xml</name>
  <files>android/app/src/main/AndroidManifest.xml</files>
  <action>
    Add the following broadcast receivers inside the <application> tag, AFTER the existing WidgetUpdateReceiver:

    <!-- Notification Broadcast Receivers for flutter_local_notifications -->
    <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationReceiver" />
    <receiver android:exported="false" android:name="com.dexterous.flutterlocalnotifications.ScheduledNotificationBootReceiver">
        <intent-filter>
            <action android:name="android.intent.action.BOOT_COMPLETED"/>
            <action android:name="android.intent.action.MY_PACKAGE_REPLACED"/>
            <action android:name="android.intent.action.QUICKBOOT_POWERON" />
            <action android:name="com.htc.intent.action.QUICKBOOT_POWERON"/>
        </intent-filter>
    </receiver>

    These receivers are REQUIRED for:
    - ScheduledNotificationReceiver: Handles scheduled notification delivery
    - ScheduledNotificationBootReceiver: Reschedules notifications after device reboot and app updates

    Place this code block after line 110 (after WidgetUpdateReceiver closing tag) and before the closing </application> tag.

    DO NOT modify any existing permissions, activities, or widget receivers.
  </action>
  <verify>grep -i "ScheduledNotificationBootReceiver" android/app/src/main/AndroidManifest.xml returns the receiver entry</verify>
  <done>Broadcast receivers added to AndroidManifest.xml with all required intent-filters</done>
</task>

<task type="auto">
  <name>Task 3: Verify build configuration supports v20.0.0</name>
  <files>android/app/build.gradle.kts</files>
  <action>
    Verify the build.gradle.kts configuration:
    1. Check that compileSdk = flutter.compileSdkVersion is set (already correct)
    2. Verify isCoreLibraryDesugaringEnabled = true is present (already correct - line 26)
    3. Verify coreLibraryDesugaring dependency is present (already correct - line 65)

    NO CHANGES NEEDED - this is a verification task only.

    The v20.0.0 package requires compileSdk 35+. If Flutter SDK is recent (3.19+), flutter.compileSdkVersion will automatically be 35+.

    To verify compileSdk value, run: flutter build apk --debug and check build output for compileSdk value.
  </action>
  <verify>flutter build apk --debug completes successfully or shows compileSdk >= 35</verify>
  <done>Build configuration verified, project builds successfully with updated package</done>
</task>

</tasks>

<verification>
1. flutter pub get completes without errors
2. pubspec.lock shows flutter_local_notifications 20.0.0
3. AndroidManifest.xml contains both ScheduledNotificationReceiver and ScheduledNotificationBootReceiver
4. flutter build apk --debug completes successfully
</verification>

<success_criteria>
- flutter_local_notifications upgraded to v20.0.0
- AndroidManifest.xml has broadcast receivers for notification persistence
- Project builds successfully with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-android-notifications-fix/11-01-SUMMARY.md`
</output>
