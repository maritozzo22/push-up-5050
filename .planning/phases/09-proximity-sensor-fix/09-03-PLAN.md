# 09-03-PLAN: Test Proximity Sensor with Physical Device

## Goal

Verify the proximity sensor works correctly on a physical Android device with the phone placed on the ground during push-ups.

## Requirements

- SENS-04: Proximity sensor mode works with phone placed on ground

## Success Criteria

1. Sensor correctly counts push-ups on physical device
2. Phone placed on ground position works reliably
3. No false positives or missed counts
4. Manual button still works as fallback

## Testing Procedure

### Setup

1. **Build APK for Android**
   ```bash
   flutter build apk --release
   ```
   Or use Android Studio as per ANDROID_BUILD.md

2. **Install on physical Android device**
   - Device must have proximity sensor
   - Android 6.0+ recommended

3. **Place phone on floor**
   - Screen facing up
   - In position where chest will be above it
   - Stable position (not sliding)

### Test Cases

#### Test 1: Basic Counting
1. Open app
2. Go to Series Selection
3. Enable "Use Proximity Sensor" toggle
4. Start workout (Series 1 = 1 push-up)
5. Place phone on floor
6. Do one push-up (chest approaches phone)
7. **Expected:** Counter increments to 1

#### Test 2: Multiple Reps
1. Start Series 2 (2 push-ups)
2. Phone on floor
3. Do two push-ups
4. **Expected:** Counter increments to 2

#### Test 3: Far-Near Transition
1. Start Series 5 (5 push-ups)
2. Phone on floor
3. Stand up (far from phone)
4. Do push-up (approach, return, stand)
5. **Expected:** Count only when chest approaches, not when returning

#### Test 4: No False Counts
1. Enable proximity sensor
2. Phone on floor
3. Walk around phone (not doing push-ups)
4. **Expected:** No counts registered

#### Test 5: Manual Fallback
1. Disable proximity sensor
2. Start workout
3. **Expected:** Manual button still works

#### Test 6: Toggle Persistence
1. Enable proximity sensor
2. Close app
3. Reopen app
4. Go to Series Selection
5. **Expected:** Toggle still enabled

### Device-Specific Behavior

**Note:** Different devices may have different sensor behaviors:

- **Nexus/Pixel devices**: Usually standard behavior
- **Samsung devices**: May have inverted values
- **Other brands**: Variable

If sensor doesn't work, check:
1. Device has proximity sensor (not all do)
2. Sensor permissions granted
3. Debug log shows sensor events

## Debug Logging

Enable debug logging to verify sensor events:

```dart
// In ProximitySensorService
void _handleProximityEvent(dynamic distance) {
  debugPrint('ðŸ“± Sensor event: $distance (near: ${distance < 0})');
  // ...
}
```

Look for in logcat:
```
flutter: ðŸ“± Sensor event: 5.0 (near: false)  # Far
flutter: ðŸ“± Sensor event: -1.0 (near: true)  # Near - COUNT!
flutter: ðŸ“± Sensor event: 8.0 (near: false)  # Far again
```

## Verification Checklist

- [ ] Basic counting works (Test 1)
- [ ] Multiple reps count correctly (Test 2)
- [ ] Far-near transition works (Test 3)
- [ ] No false counts when walking (Test 4)
- [ ] Manual button fallback works (Test 5)
- [ ] Toggle persists across app restarts (Test 6)
- [ ] Works on at least one physical device

## Known Limitations

- **Cannot test on emulator** - requires physical device
- **Not all devices have proximity sensors**
- **Sensor behavior varies by device manufacturer**

## Contingency Plans

If sensor doesn't work on test device:
1. Try multiple devices
2. Check device specs for proximity sensor
3. Adjust detection logic based on actual sensor values
4. Document which devices work/not work
5. Keep manual button as primary fallback

## Notes

- This is the ONLY way to verify proximity sensor works
- Recommend testing on 2-3 different devices if possible
- Document results in SUMMARY.md
